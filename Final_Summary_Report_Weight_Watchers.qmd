---
title: "Final Summary Report – Weight Watchers"
author: "Jin (Benjamin) Kuang, Ryan Ram, Tenchi Chen, Enkel Mezini, Christopher Chan, Siya Aneja"
date: "`r Sys.Date()`"
format: 
  html: 
    toc: true
    toc-depth: 3
---

## Introduction and Motivation
Obesity is still one of the biggest public health challenges in the United States, and its impact goes beyond physical health. Higher obesity rates are tied to conditions like diabetes and heart disease, and they can also be linked to depression and lower quality of life. These trends also increase costs for healthcare systems and employers. At the same time, obesity does not affect everyone equally. Age matters, and where someone lives matters, but the patterns are not always clear from national averages alone.

Our project asks: How do obesity rates change across age groups and regions in the U.S., and which states show unusual patterns? Instead of treating obesity as one national story, we focus on how obesity changes across adulthood and how those trends differ by state. We also look for states that stand out from the typical pattern. This approach helps connect the data to real decisions, like when prevention efforts should start and which places may need more attention.

## Importance of Analysis
Viewing obesity through both age and location has clear policy value. If some states reach high obesity levels earlier in adulthood, prevention needs to begin sooner in those places. If other states rise more slowly, the timing and focus of interventions may be different. Spotting states with unusual patterns also matters because it helps separate true public health concerns from changes that may be driven by survey instability or data quirks.

This project also highlights the need to be careful with survey-based data. We use clear visuals and simple comparisons to find patterns that are consistent across states and age groups, while staying cautious about over-interpreting noisy results. Overall, our goal is to pull out insights that are easy to explain and useful for decision-making, without pretending the data can answer every “why” question on its own.

## Data Source
```{r, warnings = FALSE}
#| code-fold: true

library(readr)
library(jsonlite)

url <- "https://data.cdc.gov/api/views/hn4x-zwk7/rows.csv?accessType=DOWNLOAD"
data_dir <- "data"
file_path <- file.path(data_dir, "cdc_data.csv")

if (!dir.exists(data_dir)) {
  dir.create(data_dir, showWarnings=FALSE, recursive = TRUE)
}

if (!file.exists(file_path)) {
  download.file(url,
                destfile = file_path, 
                mode = "wb")
}

obesity_NPO <- read_csv(file_path)

obesity_data <- read.csv("https://opendata.arcgis.com/datasets/3e0c1eb04e5c48b3be9040b0589d3ccf_8.csv")
```

National Obesity By Location: This dataset includes the percent of the state population who are obese.

Nutrition, Physical Activity, and Obesity - Behavioral Risk Factor Surveillance System: This dataset includes data on adult's diet, physical activity, age, income and other factors.

## Relation to Prior Work
Past research shows that obesity is influenced by a mix of behavior, demographics, and social conditions, and that these relationships are not the same for every group. Many studies try to identify which factors predict higher BMI or obesity, but those findings do not always translate into a clear picture of where obesity is most common and when it tends to rise across adulthood. That gap is part of why our project focuses on age and geography, since state-level patterns over the life course can be hidden when we only look at national averages.

For example, a 2009 study on lifestyle, demographics, dietary behavior, and obesity showed that one model does not fit everyone. It emphasized that factors like physical activity and sedentary time, along with demographic differences, can be strongly related to obesity, and that these relationships can vary across subgroups. A second study from 2016 compared different regression approaches and found that many core risk factors stay important across methods, but their impact can look different depending on where someone falls in the BMI range.

Together, this prior work supports two ideas that connect directly to our project. Obesity patterns differ across populations, and the way you summarize the data can change what you notice. Our project builds on this by shifting the focus to state-by-age patterns, looking at how obesity changes across adulthood in different places and identifying states where obesity becomes common earlier or where age trends look meaningfully different from the norm.

## Analysis
### [Jin (Benjamin) Kuang’s Individual Report - Are specific age groups more prone to easily become obese?](https://benjamin-kuang.github.io/STA9750-2025-FALL/Final_Individual_Report.html)

Even though it seems that anyone at any age could have obesity, obesity actually is not equally spread across all ages. Some groups of people may be more vulnerable to obesity, while other groups of people may be more resistant or resilient to obesity. My contribution to understanding **whether specific age groups in the United States are more prone to becoming obese** is helpful for government policy makers or healthcare workers to determine the potential factors that caused obesity to be so prevalent in the United States, and therefore possibly prevent it in the near future.

#### Interactive Bar Chart By Age Groups
An interactive bar chart could be applied to visualize the size of the obesity percentage in each age group to find which group has the most average percentage across all years in the United States. By doing so, the answer to the specific question **whether specific age groups in the United States are more prone to becoming obese** is clearer.
```{r, warnings = FALSE}
#| code-fold: true

library(ggplot2)
suppressWarnings(suppressPackageStartupMessages(library(plotly)))
suppressPackageStartupMessages(library(dplyr))

obesity <- subset(obesity_NPO,
                  grepl("Obese", Question, ignore.case = TRUE) |
                  grepl("Obesity", Topic, ignore.case = TRUE))

obesity_age <- obesity[!is.na(obesity$"Age(years)"), c("YearStart", "LocationAbbr", "Age(years)", "Data_Value")]

age_summary <- obesity_age |>
  group_by(`Age(years)`) |>
  summarize(`Average Percentage in Obesity` = mean(Data_Value, na.rm = TRUE),
            n = n()) |>
  rename(`Age Group` = `Age(years)`,
         `Sample Size` = n) 

highest_age_group <- age_summary |>
  slice_max(`Average Percentage in Obesity`) |>
  pull(`Age Group`)

plot_ly() |>
  add_bars(data = subset(age_summary, `Age Group` != highest_age_group),
           x = ~`Age Group`,
           y = ~`Average Percentage in Obesity`,
           text = ~paste0(round(`Average Percentage in Obesity`, 2), "%"),
           hoverinfo = "text",
           marker = list(color = "orange"),
           name = "Obesity %") |>
  add_bars(data = subset(age_summary, `Age Group` == highest_age_group),
           x = ~`Age Group`,
           y = ~`Average Percentage in Obesity`,
           text = ~paste0(round(`Average Percentage in Obesity`, 2), "%"),
           hoverinfo = "text",
           marker = list(color = "red"),
           name = "Obesity %") |>
  add_lines(data = age_summary,
            x = ~`Age Group`,
            y = ~`Average Percentage in Obesity`,
            line = list(color = "blue", width = 3),
            name = "Trend") |>
  layout(title = "Average Obesity Rate By Age Group (Interactive Plot)",
         xaxis = list(title = "Age Group",
                      categoryorder = "array",
                      categoryarray = c("18 - 24", 
                                        "25 - 34", 
                                        "35 - 44", 
                                        "45 - 54", 
                                        "55 - 64", 
                                        "65 or older")),
         yaxis = list(title = "Average Obesity Rate in the Population"))
```

From the above interactive bar chart, we can conclude that the average obesity rate for people at 18 - 24 years old is 22.2%; the average obesity rate for people at 25 -34 years old is 31.41%; the average obesity rate for people at 35 - 44 years old is 35.05%; the average obesity rate for people at 45- 54 years old is 36.64%; the average obesity rate for people at 55 - 64 years old is 36.48%; and the average obesity rate for people at 65 years old or older is 33.56%.

It is apparent to see that there is an increasing trend in the average obesity percentage in the population for people under 54 years old. This suggests that age and obesity seem to be positively correlated for people under 54 years old. In other words, before 54 years old, the older you are, the higher chance of getting obese. This number starts to drop slightly when people are 55 years old, and greatly when they are 65 years old or older.

Overall, we can conclude that younger people (who are 18 - 24 years old) are the least vulnerable group of population to obesity, while people who are at 45 - 54 years old are the most vulnerable group of population to obesity. This conclusion is actually in accordance with what permutation testing and anova testing concluded in the previous sessions, that obesity rates are not equal across all age groups in the United States. Moreover, there is a trend that more people tend to have obesity when they are getting older, and that proportion of people eventually peaks when they are 45 - 54 years old.

#### Interactive Line Chart By Years
Comparing the obesity rate across different age groups without the scale of year may not be as accurate as it is expected to be, since different years may produce different results. Consequently, it is imperative now to compare the obesity rate across different age groups for each year in this data set.
```{r}
#| code-fold: true

obesity_trend <- obesity_age |>
  group_by(YearStart, `Age(years)`) |>
  summarize(`Average Obesity` = mean(Data_Value, na.rm = TRUE),
            .groups = "drop")

plot_by_year <- ggplot(obesity_trend,
            aes(x = YearStart, y = `Average Obesity`,
                color = `Age(years)`,
                group = `Age(years)`,
                text = paste0("Age Group: ", `Age(years)`,
                              "<br>Average Obesity Rate: ", round(`Average Obesity`, 2), "%",
                              "<br>Year: ", YearStart))) +
  geom_line(linewidth = 1) +
  geom_point(size = 2) +
  labs(title = "Average Obesity Rate By Age Group Over 2011 – 2024 (Interactive Plot)",
       color = "Age Group") +
  xlab("Year") +
  ylab("Average Obesity Rate (%)") +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"))

ggplotly(plot_by_year, tooltip = "text")
```


The above line chart perfectly captures the trend of obesity rate (y-axis) across different age groups (represented by different colors) for each year between 2011 to 2024 (x-axis). From this line chart, it is obvious that age group "18 - 24" lies below all other groups for every year between 2011 to 2024, suggesting that the population whose age is between 18 to 24 is the least vulnerable population to obesity no matter what year it was. This conclusion is actually in accordance with what was just concluded in the previous sessions. On the other hand, the age group "45 - 54" lies above all other groups for every year between 2015 to 2024. Before 2015, age group 55 - 64 overwhelmed all other age groups and had the most percentage of obese people. This finding suggests that the population whose age is between 45 to 54 has become the most vulnerable population to obesity since 2015. This conclusion suggests that the age group 45 - 64 (combining 45 - 54 and 55 - 64) seems to face the highest risk of getting obesity.

Besides, an overall increasing trend for each age group from 2011 to 2024 could also be observed, which suggests that obesity for every age group has become worse and more prevalent every year than before.

### [Ryan Ram’s Individual Report - How Sharply Does Obesity Prevalence Change with Age Across U.S. States?](https://wanderloost.github.io/STA9750-2025-FALL/final%20individual%20report.html)

![Choropleth Map](Choropleth.png)

![Visual check in a few representative states](Visual check.png)

The broader project focuses on a simple but underexplored question: does obesity increase with age at the same rate everywhere, or are there states where obesity rises much more sharply as people get older? Two states might have similar overall obesity levels, yet very different age profiles, one where obesity increases gradually with age, and another where prevalence rises rapidly from young adulthood into middle age. Understanding these differences matters for prevention and policy, because it speaks to when in the life course obesity risk accelerates, not just where obesity is most prevalent.

For example, California and Illinois exhibited among the steepest increases in obesity prevalence with age, indicating a notable jump in obesity rates as adults progress through age groups. Conversely, Arizona and Mississippi showed relatively flat slopes, suggesting weaker age effects. These differences were confirmed with visualization: plotting obesity prevalence against age midpoints in selected states clearly shows that in some states, obesity rises quickly between young adulthood and middle age, while in others the pattern is flatter.

The choropleth map of slope estimates across the contiguous U.S. provides a striking visual for audiences as it highlights geographic patterns that aren’t obvious from national summaries alone, such as clusters of faster age related increases in certain regions versus flatter patterns elsewhere. To make these differences concrete, we also examined a small number of representative states with especially steep and especially flat age gradients. Visualizing obesity prevalence by age group in these states confirms that the numerical summaries reflect real, interpretable differences in how obesity prevalence evolves across adulthood.

This question fits into the overall project goal of understanding how obesity varies across states and age groups. Rather than looking at each age group separately, I focus on the relationship between age and obesity within each state, which helps identify places where aging is associated with particularly steep increases in obesity prevalence.


### [Chris’ Individual Report - Is obesity regionally concentrated based across U.S. States?](https://cchan101.github.io/STA9750-2025-FALL/STA_9750_Individual_Report.html)

```{r, warning=FALSE}
#| code-fold: true
#| output-fold: true
#| code-summary: "Data Preparation and Merging"
#| warning: false
#| message: false
library(ggplot2)
library(maps)
library(dplyr)
library(ggrepel)
library(jsonlite)

# Get US state boundary data
states_map <- map_data("state")

# Standardize state names for merging
obesity_data <- obesity_data %>%
  mutate(region = tolower(NAME))

#| code-fold: true
#| output-fold: true
#| code-summary: "Geospatial Visualization"
#| warning: false
#| message: false
# Merge obesity data with geographic boundaries
map_obesity <- left_join(states_map, obesity_data, by = "region")

# Calculate state centroids for label placement
state_centers <- map_obesity %>%
  group_by(region) %>%
  summarise(
    long = mean(long),
    lat = mean(lat),
    Obesity = first(Obesity)
  )

# Identify small northeastern states requiring special label treatment
small_states <- c("rhode island", "delaware", "connecticut", 
                  "district of columbia", "new jersey", "maryland", 
                  "massachusetts", "vermont", "new hampshire")

state_centers_large <- state_centers %>% filter(!region %in% small_states)
state_centers_small <- state_centers %>% filter(region %in% small_states)
ggplot(map_obesity, aes(x = long, y = lat, group = group, fill = Obesity)) +
  geom_polygon(color = "white", size = 0.2) +
  # Direct centroid labels for larger states
  geom_text(data = state_centers_large, 
            aes(x = long, y = lat, label = Obesity, group = NULL),
            color = "black", 
            size = 3.5, 
            fontface = "bold") +
  # Offset labels with leader lines for small northeastern states
  geom_text_repel(data = state_centers_small, 
                  aes(x = long, y = lat, 
                      label = paste0(toupper(substr(region, 1, 2)), ": ", Obesity), 
                      group = NULL),
                  color = "black", 
                  size = 2.8,
                  fontface = "bold",
                  nudge_x = 15,
                  direction = "y",
                  segment.color = "grey40",
                  segment.size = 0.3,
                  box.padding = 0.3,
                  point.padding = 0.3,
                  force = 1,
                  max.overlaps = 20) +
  scale_fill_gradient2(low = "#2c7bb6", mid = "#ffffbf", high = "#d7191c",
                       midpoint = 29, 
                       name = "Obesity Rate (%)") +
  coord_fixed(1.3) +
  theme_minimal() +
  theme(
    axis.text = element_blank(),
    axis.title = element_blank(),
    axis.ticks = element_blank(),
    panel.grid = element_blank(),
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold")
  ) +
  labs(title = "Adult Obesity Rates by State")
```
My contribution to the team project establishes a geographic baseline for adult obesity in the United States by testing whether state-level obesity prevalence is regionally clustered rather than evenly distributed. Using the Lake County, Illinois Open Data Portal's ArcGIS-hosted "National Obesity By State" dataset (a BRFSS-based snapshot), I built a reproducible data pull via ArcGIS web endpoints so the analysis can be rerun without manually downloading files. 

The resulting choropleth map reveals a distinct geographic pattern: obesity rates are not randomly distributed but instead show clear regional clustering, with the highest prevalence concentrated in a "obesity belt" across the Southeast—states like West Virginia (35.6%), Louisiana (36.2%), and Mississippi (35.6%) all exceed 35%—while the lowest rates appear in the Mountain West and Northeast, including Colorado (25.3%) and Vermont (25.1%). This approximately 14-percentage-point range from lowest to highest state demonstrates meaningful geographic variation that cannot be explained by chance alone. Within the broader project narrative, these findings contribute the essential "where" component by identifying regions with consistently elevated obesity, helping contextualize other team analyses focused on time trends, age patterns, or atypical states. Key limitations are that these aggregated state-level estimates rely on self-reported survey measures, which can mask within-state heterogeneity and may understate true prevalence. A practical next step is to replicate this work at finer geographic resolution (e.g., counties or metropolitan areas) and incorporate additional covariates such as physical activity, diet quality, income, and education levels to better explain the observed regional clustering.

### [Tenchi’s Individual Report - At what age does obesity become “common” in each state, and which states reach high obesity levels earlier or later than the national pattern?](https://chentenchi.github.io/STA9750-2025-FALL/Tenchi_Chen_Individual_Report.html) 

My contribution to the broader project asks a simple question. At what age does obesity become common in each state, and which states reach high obesity levels earlier or later than others? This matters because two states can have similar overall obesity rates but very different age patterns. If obesity becomes common by early adulthood in a state, prevention needs to start earlier. If it becomes common later, the timing and targeting of interventions may look different.

To answer this, I used CDC BRFSS obesity prevalence data grouped by state and age group. I chose a clear cutoff for “high obesity,” which is 35 percent. For each state, I checked the age groups from youngest to oldest and recorded the first age group where obesity prevalence reached 35 percent or higher. I summarized the results with a state-by-state plot using a red to green color scale, and a distribution chart showing how many states first reached the threshold in each age group.

Overall, the results suggest that in many states obesity reaches high levels by early to mid-adulthood, often by ages 25 to 34 or 35 to 44. Fewer states first cross the threshold at later ages, and some states never reach 35 percent in any age group. This supports the project’s main goal by adding a clear timing view to the geographic patterns. Important limitations are that BRFSS relies on self-reported height and weight and the age groups are broad, so the findings describe state-level patterns rather than proving causes.

```{r, echo=FALSE}
#| code-fold: true
#| warning: false
#| message: false
#| results: hide

library(tidyverse)

cdc_url <- "https://data.cdc.gov/api/views/hn4x-zwk7/rows.csv?accessType=DOWNLOAD"

raw_brfss <- read.csv(cdc_url, stringsAsFactors = FALSE)

glimpse(raw_brfss)

# Choose one recent year for the threshold analysis
target_year <- 2023   # change if your team uses a different year

# Filter to state x age-group obesity prevalence
obesity_age_state <- raw_brfss %>%
  filter(
    Class == "Obesity / Weight Status",
    grepl("obesity", Question, ignore.case = TRUE),
    Age.years. != "",
    LocationAbbr %in% state.abb,
    !is.na(Data_Value),
    Data_Value_Type == "Value"   # ensures we're using the numeric estimate
  ) %>%
  transmute(
    year        = YearStart,
    state       = LocationDesc,
    state_abbr  = LocationAbbr,
    age_group   = Age.years.,
    obesity_pct = Data_Value
  )

# Keep only the selected year
obesity_age_state_yr <- obesity_age_state %>%
  filter(year == target_year)

# Order age groups (use whatever ordering appears in the dataset)
age_levels <- obesity_age_state_yr %>%
  distinct(age_group) %>%
  arrange(age_group) %>%
  pull(age_group)

obesity_age_state_yr <- obesity_age_state_yr %>%
  mutate(age_group = factor(age_group, levels = age_levels, ordered = TRUE))

# Confirm we have 50 states x age groups (approx)
obesity_age_state_yr %>%
  summarise(
    n_rows = n(),
    n_states = n_distinct(state_abbr),
    n_age_groups = n_distinct(age_group)
  )

threshold <- 35 # percent; change if you want 30, 40, etc.

state_thresholds <- obesity_age_state_yr %>%
group_by(state, state_abbr) %>%
arrange(age_group) %>%
summarise(
first_high_age = {
idx <- which(obesity_pct >= threshold)
if (length(idx) == 0) NA_character_ else as.character(age_group[min(idx)])
},
.groups = "drop"
) %>%
mutate(
first_high_age = factor(first_high_age,
levels = age_levels,
ordered = TRUE)
)

state_thresholds %>% arrange(first_high_age, state) %>% head(20)
```

```{r}
#| code-fold: true
#| warning: false
#| message: false
# Chunk: per-state bar plot with red→green color scale

# keep only states that ever reach the threshold
plot_data <- state_thresholds %>%
  filter(!is.na(first_high_age))

# define colors from "bad" (early) to "better" (later)
age_palette <- c(
  "25 - 34" = "#d73027",  # red
  "35 - 44" = "#fc8d59",  # orange
  "45 - 54" = "#fee08b",  # yellow
  "55 - 64" = "#91cf60"   # green
  # add "65+" here if it ever appears:
  # "65+" = "#1a9850"
)

ggplot(
  plot_data,
  aes(
    x = as.numeric(first_high_age),
    y = reorder(state, as.numeric(first_high_age)),
    fill = first_high_age
  )
) +
  geom_col() +
  scale_x_continuous(
    breaks = seq_along(age_levels),
    labels = age_levels
  ) +
  scale_fill_manual(
    values = age_palette,
    name   = "Earliest age group\nwith ≥ 35% obesity"
  ) +
  labs(
    title = paste0("Earliest age group where obesity ≥ ", threshold,
                   "% by state (", target_year, ")"),
    x = "Age group (earlier = younger, more red = worse)",
    y = "State"
  ) +
  theme_minimal()

state_counts <- state_thresholds %>%
  filter(!is.na(first_high_age)) %>%
  count(first_high_age)

total_states <- sum(state_counts$n)

state_counts <- state_counts %>%
  mutate(
    perc  = 100 * n / total_states,
    # compact label: count + percent only; age group stays in legend
    label = paste0(n, " (", round(perc), "%)")
  )

age_palette <- c(
  "25 - 34" = "#d73027",  # red
  "35 - 44" = "#fc8d59",  # orange
  "45 - 54" = "#fee08b",  # yellow
  "55 - 64" = "#91cf60"   # green
)

ggplot(state_counts,
       aes(x = "", y = perc, fill = first_high_age)) +
  geom_col(width = 1, color = "white") +
  coord_polar(theta = "y") +
  scale_fill_manual(
    values = age_palette,
    name   = "Earliest age group\nwith ≥ 35% obesity"
  ) +
  geom_text(
    aes(label = label),
    position = position_stack(vjust = 0.5),
    size = 2.7   # slightly smaller so the green slice fits better
  ) +
  labs(
    title = paste0("Distribution of states by age group\n",
                   "when obesity first exceeds ", threshold,
                   "% (", target_year, ")"),
    x = NULL,
    y = NULL
  ) +
  theme_void() +
  theme(legend.position = "right")

```


### [Siya’s Individual Report - What caused obesity rates in Florida and West Virginia to act “weird”?](https://siya306.github.io/STA9750-2025-FALL/finalindividualreport.html)

![Figure: Obesity Trend Comparison – Florida vs West Virginia](https://raw.githubusercontent.com/siya306/STA9750-2025-FALL/main/image.png){fig-align="center" width="70%"}

My individual analysis focused on understanding why Florida and West Virginia appeared to exhibit “weird” obesity trends in the group’s exploratory visualizations. Florida showed pronounced year-to-year fluctuations, while West Virginia displayed a consistently higher and steeper obesity trajectory compared to most other states. By isolating state-level obesity estimates over time, the analysis demonstrated that Florida’s apparent volatility is largely attributable to survey variability, uneven temporal coverage, and population heterogeneity rather than true population-level shifts. In contrast, West Virginia’s elevated and steadily increasing obesity prevalence was consistent across years, suggesting a genuine structural public health concern rather than a data artifact. This analysis played a critical role in preventing over-interpretation of noisy patterns and helped the group distinguish between real geographic risk and instability arising from survey-based measurement.


### [Enkel’s Individual Report - Is obesity rate positively correlated with age within each state of U.S.?](https://enkelmezini.github.io/STA9750-2025-FALL/FinalProjectIndividual.html)

To move beyond national aggregates, this specific analysis investigates the "velocity" of obesity as populations age within distinct state boundaries, aiming to uncover whether the relationship between age and weight gain is universal or geographically contingent. While national trends often suggest a broad increase in prevalence over time, these summaries frequently mask significant regional nuances in how quickly health risks accelerate during the life course. By utilizing a dual-methodological approach—combining spatiotemporal heatmaps with non-parametric correlation analysis—this study visualizes the progression of obesity across six age cohorts to determine where the relationship between age and metabolic health is most pronounced.

The primary visual entry point for this investigation is a heatmap comparing obesity prevalence across all 50 states. This visualization allows for a simultaneous "bird's-eye view" of both the geographic intensity of the epidemic and the internal age-related trajectory within each state's population. By categorizing the data into ordered factors ranging from young adulthood (18–24) to seniority (65 or older), the heatmap provides a clear view of when obesity becomes a dominant health concern in different parts of the country.

```{r,message=FALSE,warning=FALSE,results='hide'}
#| code-fold: true
#| code-summary: "Show the code"
#| 
# 1. Load the readr library 
library(readr)

# 2.read_csv() to download the data
cdc_data_tidy <- read_csv("https://data.cdc.gov/api/views/hn4x-zwk7/rows.csv?accessType=DOWNLOAD")


str(cdc_data_tidy)

library(tidyverse)

# -------------------------------------------------------------------------
# 1. Data Preparation 
# -------------------------------------------------------------------------
age_data <- cdc_data_tidy %>%
  filter(Question == "Percent of adults aged 18 years and older who have obesity",
         StratificationCategory1 == "Age (years)",
         !is.na(Data_Value),
         LocationDesc != "National") %>% # Good practice to remove National aggregate
  select(LocationDesc, AgeGroup = `Age(years)`, Data_Value)

# Define ordered age levels
age_levels <- c("18 - 24", "25 - 34", "35 - 44", "45 - 54", "55 - 64", "65 or older")

# Filter and order the data
age_data_processed <- age_data %>%
  filter(AgeGroup %in% age_levels) %>%
  mutate(AgeGroup = factor(AgeGroup, levels = age_levels, ordered = TRUE),
         AgeNumeric = as.numeric(AgeGroup))


# -------------------------------------------------------------------------
# Slide 1: Heatmap with Smaller Y-Axis Labels
# -------------------------------------------------------------------------
slide1_plot <- ggplot(age_data_processed, aes(x = AgeGroup, y = LocationDesc, fill = Data_Value)) +
  geom_tile(color = "white") +
  scale_fill_viridis_c(option = "magma", name = "Obesity %") +
  theme_minimal(base_size = 10) +
  labs(title = "Obesity Rate by Age Group Across U.S. States",
       subtitle = "Prevalence generally increases up to middle age",
       x = "Age Group",
       y = "") + # Removed Y label "State" to save space
  theme(
 
    axis.text.y = element_text(size = 4.5, margin = margin(r = 2)),
    axis.text.x = element_text(size = 8),
    legend.position = "bottom", # Move legend to bottom to give more width to chart
    panel.grid = element_blank()
  )


print(slide1_plot)

```
The resulting heatmap demonstrates a strikingly consistent pattern: a visible lightening of the color gradient as cohorts move from young adulthood into middle age. In nearly every state, obesity rates climb steadily, typically reaching their zenith in the 55 to 64 age range. Notably, the 65-plus group often shows a slight "darkening" or reduction in prevalence compared to the preceding middle-aged cohort. This suggests that the relationship between age and obesity is not strictly linear throughout the entire lifespan, potentially reflecting a plateau in weight gain or the influence of health-related survival bias among older seniors.
To provide statistical rigor to these visual observations, a Spearman Rank Correlation coefficient (rs​) was calculated for every state. This non-parametric approach is particularly well-suited for ordinal age groupings, as it measures the strength and direction of the monotonic relationship between age cohort and obesity prevalence. By quantifying this link, we can distinguish between states where obesity is a predictable byproduct of aging and those where the relationship is decoupled by other environmental or cultural factors.

```{r,message=FALSE,warning=FALSE}
#| code-fold: true
#| code-summary: "Show the code"
library(tidyverse)
# -------------------------------------------------------------------------
# Slide 2: Correlation Plot with Smaller Y-Axis Labels
# -------------------------------------------------------------------------
# Calculate Correlations
state_correlations <- age_data_processed %>%
  group_by(LocationDesc) %>%
  summarize(Correlation = cor(AgeNumeric, Data_Value, method = "spearman")) %>%
  arrange(desc(Correlation))

slide2_plot <- ggplot(state_correlations, aes(x = reorder(LocationDesc, Correlation), y = Correlation)) +
  geom_col(aes(fill = Correlation > 0)) +
  coord_flip() +
  scale_fill_manual(values = c("TRUE" = "#2E86C1", "FALSE" = "#C0392B"), guide = "none") +
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray50") +
  theme_minimal(base_size = 10) +
  labs(title = "Correlation Between Age and Obesity Rate",
       subtitle = "Spearman Rank Correlation (Positive = rate increases with age)",
       x = "", # Removed X label "State" to save space
       y = "Correlation Coefficient") +
  theme(
    
    axis.text.y = element_text(size = 4.5, margin = margin(r = 2)),
    panel.grid.major.y = element_blank() # Remove horizontal grid lines for cleaner look
  )

# Print to screen to check
print(slide2_plot)


```

The correlation results validate the visual evidence, confirming a near-universal positive link between age and obesity across the United States. Out of all jurisdictions examined, every state except for Hawaii exhibits a positive correlation coefficient, indicating that as residents age, their risk of obesity significantly increases. The high-intensity correlations found in states like Massachusetts and Minnesota contrast sharply with the flatter profile of Hawaii, suggesting that Hawaii may benefit from unique cultural or environmental protective factors that mitigate age-related weight gain. Ultimately, this analysis reinforces the idea that while aging is a primary driver of obesity prevalence, the "steepness" of this risk curve is heavily influenced by the state in which one resides.

## Key Findings
The central finding is that states differ meaningfully in how obesity prevalence changes with age. In some states, obesity rises steadily but moderately across adult age groups. In others, the increase from younger to older adults is much steeper.

When these age patterns are mapped across the United States, a clear geographic pattern emerges. Some regions show consistently steeper age-related increases in obesity, while others have flatter profiles. These differences are not obvious when looking only at overall obesity rates, which highlights the value of focusing on how obesity changes across age groups within each state.

Across nearly all states, obesity prevalence increases from young adulthood into midlife. Adults aged 18 - 24 consistently show the lowest rates, prevalence rises through the 35 - 64 age range, and then levels off or declines slightly at 65 or older. Importantly, states vary in how quickly obesity rises with age. States with steeper age and obesity slopes show a widening gap between younger and older adults, while flatter slopes tend to characterize states where obesity is more uniform across adulthood.

A threshold-based summary adds another view of timing. Some states exceed 35 percent obesity by early adulthood, while others do not reach that level until later age groups or never reach it at all. Many states first exceed the threshold in the 25 - 34 or 35 - 44 age groups, while relatively few first exceed it at older ages. This offers a simple way to compare earlier-onset states to later-onset states.

State trends also show a few notable exceptions. Florida exhibits noticeable year-to-year fluctuations that look like instability rather than a sustained shift. West Virginia remains consistently high with a steady upward trajectory, suggesting a persistently elevated obesity burden compared to other states.

Across the full dataset, average obesity prevalence differs clearly by age group: 22.2% for ages 18 - 24, 31.41% for ages 25 - 34, 35.05% for ages 35 - 44, 36.64% for ages 45 - 54, 36.48% for ages 55 - 64, and 33.56% for ages 65 or older. The pattern increases through midlife, peaks around ages 45 - 54, and then declines at older ages. The time series from 2011 to 2024 reinforces this pattern and also shows an overall upward trend across age groups, suggesting obesity has become more prevalent over time..

## Conclusion
This project shows that obesity trends in the United States are shaped by both age and geography. In most states, obesity increases as people move from young adulthood into midlife, then levels off or declines slightly in older age. We also see clear regional differences, with higher levels and steeper increases concentrated in parts of the South and Appalachia.

At the same time, the analysis shows that not every unusual pattern should be treated as a real shift in population health. By combining broad exploration with focused individual analyses, we were able to separate consistent, structural patterns from results that likely reflect survey variability. For example, West Virginia appears to represent a persistently high obesity burden, while Florida’s year-to-year swings are more consistent with instability than a clear trend.

Overall, our findings suggest that effective obesity prevention needs both a national view and a state-level view. Interventions should be informed by patterns that are consistent across age groups and over time, while also accounting for places where results may be sensitive to how the data are collected and summarized.

## Limitation
This analysis uses BRFSS data, which relies on self-reported height and weight. Because people may underreport weight or overreport height, obesity prevalence can be underestimated. For that reason, the obesity rates reported here should be treated as estimates rather than exact population values.

BRFSS is also a repeated cross-sectional survey, not a study that follows the same individuals over time. Year-to-year changes reflect different samples and can be influenced by sampling and response variation. As a result, short-term fluctuations, such as those seen in Florida, may reflect survey variability rather than true changes in population health.

Finally, we worked with broad age groups and state-level summaries, and the project remained descriptive. This approach supports clear national comparisons, but it can hide local differences within states and does not explain why patterns occur. Adding factors like income, education, diet, and physical activity in future work would provide stronger explanations for the differences we observed.

## Potential Next Steps
Our findings suggest obesity is shaped by both age and location, and that states differ in how early and how sharply obesity rises across adulthood. This supports the need for prevention strategies that are tailored by state and age group rather than relying on a single national approach.

Future work could add behavioral and socioeconomic factors such as physical activity, income, and education to better explain why patterns differ across states. It could also use finer geographic units, such as counties or metro areas, to identify local hot spots that state averages may hide. Finally, these results could be turned into a simple dashboard so public health teams can track changes over time and flag emerging issues.

An additional extension would be to group predictors into micro factors and macro factors to test which scale is more strongly linked to obesity patterns. This could help clarify whether interventions should focus more on individual behaviors or on broader structural conditions.