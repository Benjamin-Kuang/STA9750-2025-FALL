<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.21">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jin Kuang">

<title>Mini Project 2 – STA 9750 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea1d7ac60288e0f1efdbc993fd8432ae.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-fae2b3aaf5b6259cdc09327568c0539e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">

<script src="site_libs/datatables-binding-0.34.0/datatables.js"></script>

<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>

<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">

<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">

<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>

<link href="site_libs/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet">

<script src="site_libs/crosstalk-1.2.2/js/crosstalk.min.js"></script>



</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Mini Project 2</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jin Kuang </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction-of-dataset" class="level2">
<h2 class="anchored" data-anchor-id="introduction-of-dataset">Introduction of Dataset</h2>
<p>We have several datasets. INCOME has the household income in specific areas and time. RENT contains the monthly rent of the household in specific areas and time. WAGES contains the wage of the wage, industry, and employment information in specific areas and time. INDUSTRY_CODES contains the code for each industry. POPULATION contains the population in specific areas and time. PERMITS contains the new housing area permitted in specific areas and time. HOUSEHOLDS contains the households number in specific areas and time.</p>
<p>We are now going to analyze some specific characteristics as indicated by the instructions posted by Professor Weylandt.</p>
</section>
<section id="task-1-data-import" class="level2">
<h2 class="anchored" data-anchor-id="task-1-data-import">Task 1: Data Import</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>))){</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>), <span class="at">showWarnings=</span><span class="cn">FALSE</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>ensure_package <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg){</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    pkg <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(pkg))</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">options</span>(<span class="at">repos =</span> <span class="fu">c</span>(<span class="at">CRAN =</span> <span class="st">"https://cloud.r-project.org"</span>))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>, <span class="at">quietly=</span><span class="cn">TRUE</span>)) <span class="fu">install.packages</span>(pkg)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>, <span class="at">quietly=</span><span class="cn">TRUE</span>))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(tidyverse)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.2
✔ ggplot2   4.0.0     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.1.0     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(glue)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(readxl)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(tidycensus)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>get_acs_all_years <span class="ot">&lt;-</span> <span class="cf">function</span>(variable, <span class="at">geography=</span><span class="st">"cbsa"</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">start_year=</span><span class="dv">2009</span>, <span class="at">end_year=</span><span class="dv">2023</span>){</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"{variable}_{geography}_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, end_year)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        YEARS <span class="ot">&lt;-</span> YEARS[YEARS <span class="sc">!=</span> <span class="dv">2020</span>] <span class="co"># Drop 2020 - No survey (covid)</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        ALL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>            tidycensus<span class="sc">::</span><span class="fu">get_acs</span>(geography, variable, <span class="at">year=</span>yy, <span class="at">survey=</span><span class="st">"acs1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">year=</span>yy) <span class="sc">|&gt;</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(<span class="sc">-</span>moe, <span class="sc">-</span>variable) <span class="sc">|&gt;</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>                <span class="fu">rename</span>(<span class="sc">!!</span><span class="at">variable :=</span> estimate)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Household income (12 month)</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>INCOME <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B19013_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">household_income =</span> B19013_001)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Monthly rent</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>RENT <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B25064_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">monthly_rent =</span> B25064_001)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Total population</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>POPULATION <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B01003_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">population =</span> B01003_001)</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Total number of households</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>HOUSEHOLDS <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B11001_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">households =</span> B11001_001)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>get_building_permits <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year =</span> <span class="dv">2009</span>, <span class="at">end_year =</span> <span class="dv">2023</span>){</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"housing_units_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        HISTORICAL_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, <span class="dv">2018</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        HISTORICAL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(HISTORICAL_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>            historical_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/txt/tb3u{yy}.txt"</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>            LINES <span class="ot">&lt;-</span> <span class="fu">readLines</span>(historical_url)[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>)]</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>            CBSA_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(LINES, <span class="st">"^[[:digit:]]"</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>            CBSA <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[CBSA_LINES], <span class="dv">5</span>, <span class="dv">10</span>))</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>            PERMIT_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(<span class="fu">str_sub</span>(LINES, <span class="dv">48</span>, <span class="dv">53</span>), <span class="st">"[[:digit:]]"</span>)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>            PERMITS <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[PERMIT_LINES], <span class="dv">48</span>, <span class="dv">53</span>))</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>            <span class="fu">data_frame</span>(<span class="at">CBSA =</span> CBSA,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">new_housing_units_permitted =</span> PERMITS, </span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">year =</span> yy)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        CURRENT_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2019</span>, end_year)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>        CURRENT_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(CURRENT_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>            current_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/xls/msaannual_{yy}99.xls"</span>)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>            temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>            <span class="fu">download.file</span>(current_url, <span class="at">destfile =</span> temp, <span class="at">mode=</span><span class="st">"wb"</span>)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>            fallback <span class="ot">&lt;-</span> <span class="cf">function</span>(.f1, .f2){</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>                <span class="cf">function</span>(...){</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">tryCatch</span>(<span class="fu">.f1</span>(...), </span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>                             <span class="at">error=</span><span class="cf">function</span>(e) <span class="fu">.f2</span>(...))</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>            reader <span class="ot">&lt;-</span> <span class="fu">fallback</span>(read_xlsx, read_xls)</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>            <span class="fu">reader</span>(temp, <span class="at">skip=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>                <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(CBSA, Total) <span class="sc">|&gt;</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">year =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>                <span class="fu">rename</span>(<span class="at">new_housing_units_permitted =</span> Total)</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>        }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>        ALL_DATA <span class="ot">&lt;-</span> <span class="fu">rbind</span>(HISTORICAL_DATA, CURRENT_DATA)</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="ot">&lt;-</span> <span class="fu">get_building_permits</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(httr2)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(rvest)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'rvest'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:readr':

    guess_encoding</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>get_bls_industry_codes <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="st">"bls_industry_codes.csv"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        resp <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://www.bls.gov"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_url_path</span>(<span class="st">"cew"</span>, <span class="st">"classifications"</span>, <span class="st">"industry"</span>, <span class="st">"industry-titles.htm"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_headers</span>(<span class="st">`</span><span class="at">User-Agent</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_error</span>(<span class="at">is_error =</span> \(resp) <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_perform</span>()</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">resp_check_status</span>(resp)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        naics_table <span class="ot">&lt;-</span> <span class="fu">resp_body_html</span>(resp) <span class="sc">|&gt;</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">html_element</span>(<span class="st">"#naics_titles"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>            <span class="fu">html_table</span>() <span class="sc">|&gt;</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">title =</span> <span class="fu">str_trim</span>(<span class="fu">str_remove</span>(<span class="fu">str_remove</span>(<span class="st">`</span><span class="at">Industry Title</span><span class="st">`</span>, Code), <span class="st">"NAICS"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">Industry Title</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">depth =</span> <span class="fu">if_else</span>(<span class="fu">nchar</span>(Code) <span class="sc">&lt;=</span> <span class="dv">5</span>, <span class="fu">nchar</span>(Code) <span class="sc">-</span> <span class="dv">1</span>, <span class="cn">NA</span>)) <span class="sc">|&gt;</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(depth))</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>        naics_table <span class="ot">&lt;-</span> naics_table <span class="sc">|&gt;</span> </span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(depth <span class="sc">==</span> <span class="dv">4</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level4_title=</span>title) <span class="sc">|&gt;</span> </span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">level1_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">2</span>), </span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>                   <span class="at">level2_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">3</span>), </span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>                   <span class="at">level3_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">4</span>)) <span class="sc">|&gt;</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>            <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level1_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level1_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>            <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level2_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level2_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>            <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level3_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level3_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"depth"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level4_code =</span> Code) <span class="sc">|&gt;</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(level1_title, level2_title, level3_title, level4_title, </span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>                   level1_code,  level2_code,  level3_code,  level4_code)</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(naics_table, fname)</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>INDUSTRY_CODES <span class="ot">&lt;-</span> <span class="fu">get_bls_industry_codes</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(httr2)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(rvest)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>get_bls_qcew_annual_averages <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year=</span><span class="dv">2009</span>, <span class="at">end_year=</span><span class="dv">2023</span>){</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"bls_qcew_{start_year}_{end_year}.csv.gz"</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, end_year)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    YEARS <span class="ot">&lt;-</span> YEARS[YEARS <span class="sc">!=</span> <span class="dv">2020</span>] <span class="co"># Drop Covid year to match ACS</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        ALL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(YEARS, <span class="at">.progress=</span><span class="cn">TRUE</span>, <span class="fu">possibly</span>(<span class="cf">function</span>(yy){</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>            fname_inner <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="fu">glue</span>(<span class="st">"{yy}_qcew_annual_singlefile.zip"</span>))</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname_inner)){</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>                <span class="fu">request</span>(<span class="st">"https://www.bls.gov"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_url_path</span>(<span class="st">"cew"</span>, <span class="st">"data"</span>, <span class="st">"files"</span>, yy, <span class="st">"csv"</span>,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">glue</span>(<span class="st">"{yy}_annual_singlefile.zip"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_headers</span>(<span class="st">`</span><span class="at">User-Agent</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_retry</span>(<span class="at">max_tries=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_perform</span>(fname_inner)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">file.info</span>(fname_inner)<span class="sc">$</span>size <span class="sc">&lt;</span> <span class="fl">755e5</span>){</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>                <span class="fu">warning</span>(<span class="fu">sQuote</span>(fname_inner), <span class="st">"appears corrupted. Please delete and retry this step."</span>)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>            <span class="fu">read_csv</span>(fname_inner, </span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>                     <span class="at">show_col_types=</span><span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">YEAR =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(area_fips, </span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>                       industry_code, </span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>                       annual_avg_emplvl, </span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>                       total_annual_wages, </span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>                       YEAR) <span class="sc">|&gt;</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(<span class="fu">nchar</span>(industry_code) <span class="sc">&lt;=</span> <span class="dv">5</span>, </span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">str_starts</span>(area_fips, <span class="st">"C"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(<span class="fu">str_detect</span>(industry_code, <span class="st">"-"</span>, <span class="at">negate=</span><span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">FIPS =</span> area_fips, </span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>                       <span class="at">INDUSTRY =</span> <span class="fu">as.integer</span>(industry_code), </span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>                       <span class="at">EMPLOYMENT =</span> <span class="fu">as.integer</span>(annual_avg_emplvl), </span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>                       <span class="at">TOTAL_WAGES =</span> total_annual_wages) <span class="sc">|&gt;</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(<span class="sc">-</span>area_fips, </span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>industry_code, </span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>annual_avg_emplvl, </span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>total_annual_wages) <span class="sc">|&gt;</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 10 is a special value: "all industries" , so omit</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(INDUSTRY <span class="sc">!=</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">AVG_WAGE =</span> TOTAL_WAGES <span class="sc">/</span> EMPLOYMENT)</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>        })) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>    ALL_DATA <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>    ALL_DATA_YEARS <span class="ot">&lt;-</span> <span class="fu">unique</span>(ALL_DATA<span class="sc">$</span>YEAR)</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>    YEARS_DIFF <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(YEARS, ALL_DATA_YEARS)</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(YEARS_DIFF) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Download failed for the following years: "</span>, YEARS_DIFF, </span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>             <span class="st">". Please delete intermediate files and try again."</span>)</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>    ALL_DATA</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>WAGES <span class="ot">&lt;-</span> <span class="fu">get_bls_qcew_annual_averages</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="extra-credit-opportunity-01-relationship-diagram" class="level2">
<h2 class="anchored" data-anchor-id="extra-credit-opportunity-01-relationship-diagram">Extra Credit Opportunity #01: Relationship Diagram</h2>
<p><img src="Relationship Diagram.png" class="img-fluid"></p>
</section>
<section id="task-2-multi-table-questions" class="level2">
<h2 class="anchored" data-anchor-id="task-2-multi-table-questions">Task 2: Multi-Table Questions</h2>
<section id="which-cbsa-by-name-permitted-the-largest-number-of-new-housing-units-in-the-decade-from-2010-to-2019-inclusive" class="level3">
<h3 class="anchored" data-anchor-id="which-cbsa-by-name-permitted-the-largest-number-of-new-housing-units-in-the-decade-from-2010-to-2019-inclusive">1. Which CBSA (by name) permitted the largest number of new housing units in the decade from 2010 to 2019 (inclusive)?</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="sc">|&gt;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2010</span>, year <span class="sc">&lt;=</span> <span class="dv">2019</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CBSA) <span class="sc">|&gt;</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="st">`</span><span class="at">New Housing Units Permitted</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(new_housing_units_permitted)) <span class="sc">|&gt;</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(INCOME <span class="sc">|&gt;</span> <span class="fu">distinct</span>(GEOID, NAME), <span class="fu">join_by</span>(CBSA <span class="sc">==</span> GEOID)) <span class="sc">|&gt;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="st">`</span><span class="at">New Housing Units Permitted</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(<span class="at">options =</span> <span class="fu">list</span>(<span class="at">searching =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>)) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-1909449cfdd1428ae1f4" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1909449cfdd1428ae1f4">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438","439","440","441","442","443","444","445","446","447","448","449","450","451","452","453","454","455","456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","471","472","473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489","490","491","492","493","494","495","496","497","498","499","500","501","502","503","504","505","506","507","508","509","510","511","512","513","514","515","516","517","518","519","520","521","522","523","524","525","526","527","528","529","530","531","532","533","534","535","536","537","538","539","540","541","542","543","544","545","546","547","548","549","550","551","552","553","554","555"],[26420,26420,26420,19100,35620,35620,35620,12060,12060,12060,47900,38060,38060,38060,42660,12420,12420,12420,31080,36740,36740,16740,16740,16740,33100,33100,19740,19740,19740,34980,16980,16980,16980,16980,45300,33460,14460,14460,38900,38900,41860,41860,41860,39580,39580,37980,40140,29820,29820,29820,41700,41700,27260,41740,41740,41740,26900,26900,26900,28140,18140,12580,12580,31100,41940,41180,19820,19820,41620,41620,35840,35840,36420,47260,47260,16700,16700,40900,40900,40900,14260,14260,40060,34820,34820,34820,15980,17140,17140,19780,39340,39340,24860,24860,24860,24860,31140,31140,38300,36540,36540,17900,32580,20500,17820,46140,21340,22220,22220,32820,29460,12940,31540,46060,34940,34940,28940,13820,13820,36260,36260,24340,24340,24340,35380,35380,30780,12260,48900,17460,17460,26620,39900,39900,33340,33340,24540,44060,44060,23420,28660,28660,22660,22660,24660,49180,22020,10580,19660,37860,10740,11700,41540,41540,12540,12540,30460,43620,43620,42340,37340,41100,16860,38860,38860,31180,44700,44700,17780,17300,40380,22180,30700,25060,25060,38940,39300,39300,14860,14860,18580,44180,18880,48620,28420,28420,25420,45220,15380,15380,15380,29180,27140,43900,14500,13460,13460,19300,19300,25540,25540,49340,49340,27340,17660,29700,46520,15180,23060,43340,36500,36500,36500,10900,25940,25940,25940,25940,29540,36100,29340,13140,47300,47300,45540,45540,37100,23540,42220,42220,41420,16820,26980,45060,17860,13900,20100,13740,24580,40340,17980,12220,46220,13380,33260,47380,14540,25180,39140,21660,21660,35300,35300,16580,39460,33660,37460,37460,37460,19380,15500,33860,30860,31700,47580,45780,23580,49620,10420,16300,14740,14740,11100,11260,29740,29620,36220,12020,11540,46700,46700,42680,42680,15540,24780,26180,42540,42540,46660,27860,42020,42020,49740,21780,21780,39660,31340,12100,25860,26820,39100,32780,19340,41060,27740,49020,17020,29200,20260,33540,36140,22900,29420,12700,45940,45940,45940,42200,29940,20740,28020,33740,17420,44140,31740,40220,28700,28700,21060,21060,22500,48300,48300,11460,43780,24300,11180,22380,26380,26380,37900,25220,25220,49420,15940,24220,15260,15260,44300,43300,47940,13980,13980,27900,27900,46340,41500,33700,14020,25500,15680,31860,31860,39740,16940,36780,35980,35980,29100,29100,43580,27060,34580,30980,44100,32900,20020,25980,25980,27980,27980,27980,16220,25260,10780,31420,31420,21500,22520,48140,48140,10180,26140,26140,20220,16020,16020,29140,45820,49660,49660,42100,44940,22420,30140,36980,31460,31460,21140,12620,18700,39820,41660,27180,49700,10540,10540,10540,46540,24020,33780,39380,26580,16620,28740,20940,26100,24140,10500,27620,45460,40980,40980,47020,22540,39540,39540,44420,44420,44420,44420,27500,27500,31020,31020,34900,34100,40580,14060,35100,35100,13780,39150,34060,18020,35660,35660,38540,16540,16540,16540,34740,34740,45500,45500,40420,24500,29020,42140,48660,14010,38340,19140,30340,47220,47220,47220,11340,24260,24260,43100,30020,33140,23900,23900,19460,25620,48700,42060,22140,27100,41140,37620,37620,43420,43420,24420,24420,40660,37700,19430,19430,37380,47460,48060,48060,20700,20700,11020,34620,21300,16180,42700,42700,42700,16060,28100,28100,30620,30300,33220,33220,14100,14100,23460,19060,19060,46300,46300,44220,13020,11500,11500,27780,38220,38220,19260,19260,31900,12980,19500,26300,13220,13220,48540,11300,21820,21820,19180,19180,21420,41780,41780,48260,44600],[482075,482075,482075,460826,446020,446020,446020,254377,254377,254377,232483,219939,219939,219939,213022,212392,212392,212392,184260,171588,171588,170359,170359,170359,164006,164006,160762,160762,160762,145531,145175,145175,145175,145175,140207,127378,118018,118018,117234,117234,116917,116917,116917,116534,116534,115019,101466,100807,100807,100807,98429,98429,94357,78834,78834,78834,76533,76533,76533,75524,74006,72300,72300,67286,66077,65192,63776,63776,63479,63479,62245,62245,59298,58629,58629,57575,57575,57144,57144,57144,56352,56352,51093,50763,50763,50763,50253,48807,48807,47942,45973,45973,43432,43432,43432,43432,42813,42813,40764,40714,40714,40554,40099,39360,39344,36763,36501,35506,35506,35280,34738,34440,31932,31868,30939,30939,30308,29688,29688,29273,29273,28918,28918,28918,28736,28736,28099,27803,27081,26912,26912,26773,26607,26607,26400,26400,25971,24958,24958,24859,24053,24053,23423,23423,23150,22851,22751,22590,22427,22315,21981,21859,21814,21814,21054,21054,21004,20967,20967,20672,20559,20200,20155,19669,19669,19236,19138,19138,18861,18461,18379,18367,18263,18256,18256,18249,18130,18130,18034,18034,18014,17966,17885,17583,17115,17115,16747,16546,16321,16321,16321,16272,15664,15062,14978,14851,14851,14721,14721,14601,14601,14494,14494,14474,14046,13781,13726,13631,13591,13258,13119,13119,13119,13069,12809,12809,12809,12809,12736,12540,12505,12381,12305,12305,12028,12028,11996,11906,11804,11804,11795,11693,11377,11285,11260,11044,10935,10928,10744,10694,10641,10615,10599,10574,10327,10299,10187,9996,9956,9784,9784,9780,9780,9749,9717,9710,9669,9669,9669,9365,9362,9292,9266,9248,9183,9166,9133,8969,8880,8829,8815,8815,8802,8644,8569,8469,8377,8355,8183,8177,8177,8149,8149,8055,8017,7980,7923,7923,7858,7809,7733,7733,7718,7680,7680,7472,7282,7222,7169,7115,7034,6963,6803,6700,6565,6501,6443,6379,6369,6244,6244,6217,6163,6116,6106,6106,6106,6062,6003,5960,5922,5851,5810,5773,5769,5684,5683,5683,5613,5613,5600,5589,5589,5584,5558,5554,5487,5455,5370,5370,5249,5210,5210,5205,5155,5152,4961,4961,4853,4781,4745,4740,4740,4727,4727,4689,4680,4677,4654,4582,4580,4529,4529,4459,4389,4297,4221,4221,4092,4092,4068,4046,3881,3876,3864,3803,3802,3789,3789,3763,3763,3763,3709,3677,3636,3625,3625,3509,3502,3490,3490,3484,3422,3422,3416,3409,3409,3403,3343,3318,3318,3274,3267,3263,3238,3191,3146,3146,3098,3093,3080,3049,3032,3022,2983,2958,2958,2958,2937,2908,2869,2832,2796,2766,2754,2692,2682,2676,2650,2607,2580,2530,2530,2495,2488,2481,2481,2470,2470,2470,2470,2455,2455,2388,2388,2323,2278,2276,2256,2227,2227,2194,2180,2125,2100,2060,2060,2045,2042,2042,2042,2007,2007,1998,1998,1995,1984,1979,1974,1934,1807,1763,1739,1736,1714,1714,1714,1692,1654,1654,1612,1595,1594,1552,1552,1508,1503,1501,1497,1463,1436,1323,1317,1317,1308,1308,1307,1307,1293,1268,1231,1231,1226,1211,1188,1188,1161,1161,1158,1126,1121,1108,1087,1087,1087,1068,1059,1059,1025,1011,937,937,927,927,915,904,904,835,835,822,819,816,816,795,742,742,659,659,620,619,610,554,543,543,509,316,305,305,266,266,234,219,219,204,115],["Houston-Sugar Land-Baytown, TX Metro Area","Houston-The Woodlands-Sugar Land, TX Metro Area","Houston-Pasadena-The Woodlands, TX Metro Area","Dallas-Fort Worth-Arlington, TX Metro Area","New York-Northern New Jersey-Long Island, NY-NJ-PA Metro Area","New York-Newark-Jersey City, NY-NJ-PA Metro Area","New York-Newark-Jersey City, NY-NJ Metro Area","Atlanta-Sandy Springs-Marietta, GA Metro Area","Atlanta-Sandy Springs-Roswell, GA Metro Area","Atlanta-Sandy Springs-Alpharetta, GA Metro Area","Washington-Arlington-Alexandria, DC-VA-MD-WV Metro Area","Phoenix-Mesa-Scottsdale, AZ Metro Area","Phoenix-Mesa-Glendale, AZ Metro Area","Phoenix-Mesa-Chandler, AZ Metro Area","Seattle-Tacoma-Bellevue, WA Metro Area","Austin-Round Rock, TX Metro Area","Austin-Round Rock-San Marcos, TX Metro Area","Austin-Round Rock-Georgetown, TX Metro Area","Los Angeles-Long Beach-Anaheim, CA Metro Area","Orlando-Kissimmee, FL Metro Area","Orlando-Kissimmee-Sanford, FL Metro Area","Charlotte-Gastonia-Concord, NC-SC Metro Area","Charlotte-Gastonia-Rock Hill, NC-SC Metro Area","Charlotte-Concord-Gastonia, NC-SC Metro Area","Miami-Fort Lauderdale-Pompano Beach, FL Metro Area","Miami-Fort Lauderdale-West Palm Beach, FL Metro Area","Denver-Aurora-Broomfield, CO Metro Area","Denver-Aurora-Lakewood, CO Metro Area","Denver-Aurora-Centennial, CO Metro Area","Nashville-Davidson--Murfreesboro--Franklin, TN Metro Area","Chicago-Naperville-Joliet, IL-IN-WI Metro Area","Chicago-Joliet-Naperville, IL-IN-WI Metro Area","Chicago-Naperville-Elgin, IL-IN-WI Metro Area","Chicago-Naperville-Elgin, IL-IN Metro Area","Tampa-St. Petersburg-Clearwater, FL Metro Area","Minneapolis-St. Paul-Bloomington, MN-WI Metro Area","Boston-Cambridge-Quincy, MA-NH Metro Area","Boston-Cambridge-Newton, MA-NH Metro Area","Portland-Vancouver-Beaverton, OR-WA Metro Area","Portland-Vancouver-Hillsboro, OR-WA Metro Area","San Francisco-Oakland-Fremont, CA Metro Area","San Francisco-Oakland-Hayward, CA Metro Area","San Francisco-Oakland-Berkeley, CA Metro Area","Raleigh-Cary, NC Metro Area","Raleigh, NC Metro Area","Philadelphia-Camden-Wilmington, PA-NJ-DE-MD Metro Area","Riverside-San Bernardino-Ontario, CA Metro Area","Las Vegas-Paradise, NV Metro Area","Las Vegas-Henderson-Paradise, NV Metro Area","Las Vegas-Henderson-North Las Vegas, NV Metro Area","San Antonio, TX Metro Area","San Antonio-New Braunfels, TX Metro Area","Jacksonville, FL Metro Area","San Diego-Carlsbad-San Marcos, CA Metro Area","San Diego-Carlsbad, CA Metro Area","San Diego-Chula Vista-Carlsbad, CA Metro Area","Indianapolis-Carmel, IN Metro Area","Indianapolis-Carmel-Anderson, IN Metro Area","Indianapolis-Carmel-Greenwood, IN Metro Area","Kansas City, MO-KS Metro Area","Columbus, OH Metro Area","Baltimore-Towson, MD Metro Area","Baltimore-Columbia-Towson, MD Metro Area","Los Angeles-Long Beach-Santa Ana, CA Metro Area","San Jose-Sunnyvale-Santa Clara, CA Metro Area","St. Louis, MO-IL Metro Area","Detroit-Warren-Livonia, MI Metro Area","Detroit-Warren-Dearborn, MI Metro Area","Salt Lake City, UT Metro Area","Salt Lake City-Murray, UT Metro Area","North Port-Bradenton-Sarasota, FL Metro Area","North Port-Sarasota-Bradenton, FL Metro Area","Oklahoma City, OK Metro Area","Virginia Beach-Norfolk-Newport News, VA-NC Metro Area","Virginia Beach-Chesapeake-Norfolk, VA-NC Metro Area","Charleston-North Charleston-Summerville, SC Metro Area","Charleston-North Charleston, SC Metro Area","Sacramento--Arden-Arcade--Roseville, CA Metro Area","Sacramento--Roseville--Arden-Arcade, CA Metro Area","Sacramento-Roseville-Folsom, CA Metro Area","Boise City-Nampa, ID Metro Area","Boise City, ID Metro Area","Richmond, VA Metro Area","Myrtle Beach-North Myrtle Beach-Conway, SC Metro Area","Myrtle Beach-Conway-North Myrtle Beach, SC-NC Metro Area","Myrtle Beach-Conway-North Myrtle Beach, SC Metro Area","Cape Coral-Fort Myers, FL Metro Area","Cincinnati-Middletown, OH-KY-IN Metro Area","Cincinnati, OH-KY-IN Metro Area","Des Moines-West Des Moines, IA Metro Area","Provo-Orem, UT Metro Area","Provo-Orem-Lehi, UT Metro Area","Greenville-Mauldin-Easley, SC Metro Area","Greenville-Anderson-Mauldin, SC Metro Area","Greenville-Anderson, SC Metro Area","Greenville-Anderson-Greer, SC Metro Area","Louisville-Jefferson County, KY-IN Metro Area","Louisville/Jefferson County, KY-IN Metro Area","Pittsburgh, PA Metro Area","Omaha-Council Bluffs, NE-IA Metro Area","Omaha, NE-IA Metro Area","Columbia, SC Metro Area","McAllen-Edinburg-Mission, TX Metro Area","Durham-Chapel Hill, NC Metro Area","Colorado Springs, CO Metro Area","Tulsa, OK Metro Area","El Paso, TX Metro Area","Fayetteville-Springdale-Rogers, AR-MO Metro Area","Fayetteville-Springdale-Rogers, AR Metro Area","Memphis, TN-MS-AR Metro Area","Lakeland-Winter Haven, FL Metro Area","Baton Rouge, LA Metro Area","Madison, WI Metro Area","Tucson, AZ Metro Area","Naples-Marco Island, FL Metro Area","Naples-Immokalee-Marco Island, FL Metro Area","Knoxville, TN Metro Area","Birmingham-Hoover, AL Metro Area","Birmingham, AL Metro Area","Ogden-Clearfield, UT Metro Area","Ogden, UT Metro Area","Grand Rapids-Wyoming, MI Metro Area","Grand Rapids-Kentwood, MI Metro Area","Grand Rapids-Wyoming-Kentwood, MI Metro Area","New Orleans-Metairie-Kenner, LA Metro Area","New Orleans-Metairie, LA Metro Area","Little Rock-North Little Rock-Conway, AR Metro Area","Augusta-Richmond County, GA-SC Metro Area","Wilmington, NC Metro Area","Cleveland-Elyria-Mentor, OH Metro Area","Cleveland-Elyria, OH Metro Area","Huntsville, AL Metro Area","Reno-Sparks, NV Metro Area","Reno, NV Metro Area","Milwaukee-Waukesha-West Allis, WI Metro Area","Milwaukee-Waukesha, WI Metro Area","Greeley, CO Metro Area","Spokane, WA Metro Area","Spokane-Spokane Valley, WA Metro Area","Fresno, CA Metro Area","Killeen-Temple-Fort Hood, TX Metro Area","Killeen-Temple, TX Metro Area","Fort Collins-Loveland, CO Metro Area","Fort Collins, CO Metro Area","Greensboro-High Point, NC Metro Area","Winston-Salem, NC Metro Area","Fargo, ND-MN Metro Area","Albany-Schenectady-Troy, NY Metro Area","Deltona-Daytona Beach-Ormond Beach, FL Metro Area","Pensacola-Ferry Pass-Brent, FL Metro Area","Albuquerque, NM Metro Area","Asheville, NC Metro Area","Salisbury, MD Metro Area","Salisbury, MD-DE Metro Area","Bakersfield, CA Metro Area","Bakersfield-Delano, CA Metro Area","Lexington-Fayette, KY Metro Area","Sioux Falls, SD Metro Area","Sioux Falls, SD-MN Metro Area","Savannah, GA Metro Area","Palm Bay-Melbourne-Titusville, FL Metro Area","St. George, UT Metro Area","Chattanooga, TN-GA Metro Area","Portland-South Portland-Biddeford, ME Metro Area","Portland-South Portland, ME Metro Area","Lubbock, TX Metro Area","Stockton, CA Metro Area","Stockton-Lodi, CA Metro Area","College Station-Bryan, TX Metro Area","Clarksville, TN-KY Metro Area","Rochester, NY Metro Area","Fayetteville, NC Metro Area","Lincoln, NE Metro Area","Gulfport-Biloxi, MS Metro Area","Gulfport-Biloxi-Pascagoula, MS Metro Area","Port St. Lucie, FL Metro Area","Providence-New Bedford-Fall River, RI-MA Metro Area","Providence-Warwick, RI-MA Metro Area","Bridgeport-Stamford-Norwalk, CT Metro Area","Bridgeport-Stamford-Danbury, CT Metro Area","Corpus Christi, TX Metro Area","Springfield, MO Metro Area","Crestview-Fort Walton Beach-Destin, FL Metro Area","Wichita, KS Metro Area","Kennewick-Pasco-Richland, WA Metro Area","Kennewick-Richland, WA Metro Area","Harrisburg-Carlisle, PA Metro Area","Tallahassee, FL Metro Area","Buffalo-Niagara Falls, NY Metro Area","Buffalo-Cheektowaga-Niagara Falls, NY Metro Area","Buffalo-Cheektowaga, NY Metro Area","Lafayette, LA Metro Area","Jackson, MS Metro Area","Spartanburg, SC Metro Area","Boulder, CO Metro Area","Bend, OR Metro Area","Bend-Redmond, OR Metro Area","Daphne-Fairhope-Foley, AL Micro Area","Daphne-Fairhope-Foley, AL Metro Area","Hartford-West Hartford-East Hartford, CT Metro Area","Hartford-East Hartford-Middletown, CT Metro Area","Worcester, MA Metro Area","Worcester, MA-CT Metro Area","Jacksonville, NC Metro Area","Coeur d'Alene, ID Metro Area","Laredo, TX Metro Area","Urban Honolulu, HI Metro Area","Brownsville-Harlingen, TX Metro Area","Fort Wayne, IN Metro Area","Shreveport-Bossier City, LA Metro Area","Olympia, WA Metro Area","Olympia-Tumwater, WA Metro Area","Olympia-Lacey-Tumwater, WA Metro Area","Allentown-Bethlehem-Easton, PA-NJ Metro Area","Hilton Head Island-Beaufort, SC Micro Area","Hilton Head Island-Bluffton-Beaufort, SC Metro Area","Hilton Head Island-Bluffton, SC Metro Area","Hilton Head Island-Bluffton-Port Royal, SC Metro Area","Lancaster, PA Metro Area","Ocala, FL Metro Area","Lake Charles, LA Metro Area","Beaumont-Port Arthur, TX Metro Area","Visalia-Porterville, CA Metro Area","Visalia, CA Metro Area","The Villages, FL Micro Area","The Villages, FL Metro Area","Oxnard-Thousand Oaks-Ventura, CA Metro Area","Gainesville, FL Metro Area","Santa Rosa-Petaluma, CA Metro Area","Santa Rosa, CA Metro Area","Salem, OR Metro Area","Charlottesville, VA Metro Area","Iowa City, IA Metro Area","Syracuse, NY Metro Area","Columbia, MO Metro Area","Bismarck, ND Metro Area","Dover, DE Metro Area","Billings, MT Metro Area","Green Bay, WI Metro Area","Rochester, MN Metro Area","Columbus, GA-AL Metro Area","Auburn-Opelika, AL Metro Area","Tuscaloosa, AL Metro Area","Bellingham, WA Metro Area","Midland, TX Metro Area","Waco, TX Metro Area","Bowling Green, KY Metro Area","Hagerstown-Martinsburg, MD-WV Metro Area","Prescott, AZ Metro Area","Eugene-Springfield, OR Metro Area","Eugene, OR Metro Area","New Haven-Milford, CT Metro Area","New Haven, CT Metro Area","Champaign-Urbana, IL Metro Area","Punta Gorda, FL Metro Area","Mobile, AL Metro Area","Panama City-Lynn Haven-Panama City Beach, FL Metro Area","Panama City, FL Metro Area","Panama City-Panama City Beach, FL Metro Area","Dayton, OH Metro Area","Burlington, NC Metro Area","Montgomery, AL Metro Area","Logan, UT-ID Metro Area","Manchester-Nashua, NH Metro Area","Warner Robins, GA Metro Area","Toledo, OH Metro Area","Gainesville, GA Metro Area","York-Hanover, PA Metro Area","Akron, OH Metro Area","Cedar Rapids, IA Metro Area","Bremerton-Silverdale, WA Metro Area","Bremerton-Silverdale-Port Orchard, WA Metro Area","Amarillo, TX Metro Area","Anchorage, AK Metro Area","Las Cruces, NM Metro Area","Lansing-East Lansing, MI Metro Area","Odessa, TX Metro Area","Athens-Clarke County, GA Metro Area","Appleton, WI Metro Area","Vallejo-Fairfield, CA Metro Area","Vallejo, CA Metro Area","Sebastian-Vero Beach, FL Metro Area","Sebastian-Vero Beach-West Vero Corridor, FL Metro Area","Burlington-South Burlington, VT Metro Area","Greenville, NC Metro Area","Honolulu, HI Metro Area","Scranton--Wilkes-Barre, PA Metro Area","Scranton--Wilkes-Barre--Hazleton, PA Metro Area","Valdosta, GA Metro Area","Jonesboro, AR Metro Area","San Luis Obispo-Paso Robles, CA Metro Area","San Luis Obispo-Paso Robles-Arroyo Grande, CA Metro Area","Yuma, AZ Metro Area","Evansville, IN-KY Metro Area","Evansville, IN Metro Area","Rapid City, SD Metro Area","Lynchburg, VA Metro Area","Atlantic City-Hammonton, NJ Metro Area","Hickory-Lenoir-Morganton, NC Metro Area","Idaho Falls, ID Metro Area","Poughkeepsie-Newburgh-Middletown, NY Metro Area","Medford, OR Metro Area","Davenport-Moline-Rock Island, IA-IL Metro Area","St. Cloud, MN Metro Area","Johnson City, TN Metro Area","Winchester, VA-WV Metro Area","Chico, CA Metro Area","Lafayette-West Lafayette, IN Metro Area","Duluth, MN-WI Metro Area","Missoula, MT Metro Area","Ocean City, NJ Metro Area","Fort Smith, AR-OK Metro Area","Lake Havasu City-Kingman, AZ Metro Area","Barnstable Town, MA Metro Area","Trenton-Ewing, NJ Metro Area","Trenton, NJ Metro Area","Trenton-Princeton, NJ Metro Area","Santa Maria-Santa Barbara, CA Metro Area","Lawrence, KS Metro Area","Eau Claire, WI Metro Area","Kalamazoo-Portage, MI Metro Area","Monroe, LA Metro Area","Cleveland, TN Metro Area","Springfield, MA Metro Area","Manhattan, KS Metro Area","Roanoke, VA Metro Area","Kingsport-Bristol-Bristol, TN-VA Metro Area","Kingsport-Bristol, TN-VA Metro Area","Elizabethtown, KY Metro Area","Elizabethtown-Fort Knox, KY Metro Area","Florence, SC Metro Area","Wenatchee-East Wenatchee, WA Metro Area","Wenatchee, WA Metro Area","Ann Arbor, MI Metro Area","South Bend-Mishawaka, IN-MI Metro Area","Grand Junction, CO Metro Area","Ames, IA Metro Area","Flagstaff, AZ Metro Area","Houma-Bayou Cane-Thibodaux, LA Metro Area","Houma-Thibodaux, LA Metro Area","Peoria, IL Metro Area","Hammond, LA Micro Area","Hammond, LA Metro Area","Yakima, WA Metro Area","Canton-Massillon, OH Metro Area","Grand Forks, ND-MN Metro Area","Brunswick, GA Metro Area","Brunswick-St. Simons, GA Metro Area","State College, PA Metro Area","Sherman-Denison, TX Metro Area","Waterloo-Cedar Falls, IA Metro Area","Blacksburg-Christiansburg-Radford, VA Metro Area","Blacksburg-Christiansburg, VA Metro Area","Joplin, MO Metro Area","Joplin, MO-KS Metro Area","Tyler, TX Metro Area","Salinas, CA Metro Area","Modesto, CA Metro Area","Bloomington, IN Metro Area","Harrisonburg, VA Metro Area","California-Lexington Park, MD Metro Area","Mankato-North Mankato, MN Metro Area","Mankato, MN Metro Area","Reading, PA Metro Area","Cheyenne, WY Metro Area","Oshkosh-Neenah, WI Metro Area","Norwich-New London, CT Metro Area","Norwich-New London-Willimantic, CT Metro Area","La Crosse, WI-MN Metro Area","La Crosse-Onalaska, WI-MN Metro Area","Sioux City, IA-NE-SD Metro Area","Ithaca, NY Metro Area","Mount Vernon-Anacortes, WA Metro Area","Longview, TX Metro Area","Springfield, IL Metro Area","Merced, CA Metro Area","Dothan, AL Metro Area","Hinesville-Fort Stewart, GA Metro Area","Hinesville, GA Metro Area","Kahului-Wailuku, HI Micro Area","Kahului-Wailuku-Lahaina, HI Metro Area","Kahului-Wailuku, HI Metro Area","Casper, WY Metro Area","Hanford-Corcoran, CA Metro Area","Alexandria, LA Metro Area","Macon, GA Metro Area","Macon-Bibb County, GA Metro Area","Erie, PA Metro Area","Florence-Muscle Shoals, AL Metro Area","Wausau, WI Metro Area","Wausau-Weston, WI Metro Area","Abilene, TX Metro Area","Homosassa Springs, FL Micro Area","Homosassa Springs, FL Metro Area","Dubuque, IA Metro Area","Cape Girardeau-Jackson, MO-IL Metro Area","Cape Girardeau, MO-IL Metro Area","Lafayette, IN Metro Area","Topeka, KS Metro Area","Youngstown-Warren-Boardman, OH-PA Metro Area","Youngstown-Warren, OH Metro Area","Santa Cruz-Watsonville, CA Metro Area","Sumter, SC Metro Area","Flint, MI Metro Area","Lebanon, PA Metro Area","Owensboro, KY Metro Area","Madera-Chowchilla, CA Metro Area","Madera, CA Metro Area","Elkhart-Goshen, IN Metro Area","Bangor, ME Metro Area","Corvallis, OR Metro Area","Redding, CA Metro Area","San Angelo, TX Metro Area","Jackson, TN Metro Area","Yuba City, CA Metro Area","Albany-Lebanon, OR Micro Area","Albany, OR Metro Area","Albany-Lebanon, OR Metro Area","Utica-Rome, NY Metro Area","Glens Falls, NY Metro Area","Monroe, MI Metro Area","Pueblo, CO Metro Area","Huntington-Ashland, WV-KY-OH Metro Area","Charleston, WV Metro Area","Kingston, NY Metro Area","El Centro, CA Metro Area","Holland-Grand Haven, MI Metro Area","Goldsboro, NC Metro Area","Albany, GA Metro Area","Jefferson City, MO Metro Area","Terre Haute, IN Metro Area","Saginaw-Saginaw Township North, MI Metro Area","Saginaw, MI Metro Area","Victoria, TX Metro Area","Fond du Lac, WI Metro Area","Racine, WI Metro Area","Racine-Mount Pleasant, WI Metro Area","Staunton-Waynesboro, VA Micro Area","Staunton-Waynesboro, VA Metro Area","Staunton, VA Metro Area","Staunton-Stuarts Draft, VA Metro Area","Janesville, WI Metro Area","Janesville-Beloit, WI Metro Area","Longview, WA Metro Area","Longview-Kelso, WA Metro Area","Napa, CA Metro Area","Morristown, TN Metro Area","Rocky Mount, NC Metro Area","Bloomington-Normal, IL Metro Area","New Bern, NC Micro Area","New Bern, NC Metro Area","Binghamton, NY Metro Area","Prescott Valley-Prescott, AZ Metro Area","Morgantown, WV Metro Area","Columbus, IN Metro Area","Niles-Benton Harbor, MI Metro Area","Niles, MI Metro Area","Pocatello, ID Metro Area","Chambersburg, PA Micro Area","Chambersburg-Waynesboro, PA Metro Area","Chambersburg, PA Metro Area","Muskegon-Norton Shores, MI Metro Area","Muskegon, MI Metro Area","Texarkana, TX-Texarkana, AR Metro Area","Texarkana, TX-AR Metro Area","Rockford, IL Metro Area","Great Falls, MT Metro Area","Kokomo, IN Metro Area","Santa Fe, NM Metro Area","Wichita Falls, TX Metro Area","Bloomington, IL Metro Area","Pittsfield, MA Metro Area","Dalton, GA Metro Area","Lewiston-Auburn, ME Metro Area","Vineland-Millville-Bridgeton, NJ Metro Area","Vineland-Bridgeton, NJ Metro Area","Vineland, NJ Metro Area","Anderson, SC Metro Area","Grand Island, NE Micro Area","Grand Island, NE Metro Area","Sheboygan, WI Metro Area","Lawton, OK Metro Area","Michigan City-La Porte, IN Metro Area","Gettysburg, PA Micro Area","Gettysburg, PA Metro Area","Decatur, AL Metro Area","Hattiesburg, MS Metro Area","Williamsport, PA Metro Area","Santa Barbara-Santa Maria-Goleta, CA Metro Area","Farmington, NM Metro Area","Jackson, MI Metro Area","St. Joseph, MO-KS Metro Area","Parkersburg-Marietta-Vienna, WV-OH Metro Area","Parkersburg-Vienna, WV Metro Area","Sierra Vista-Douglas, AZ Micro Area","Sierra Vista-Douglas, AZ Metro Area","Grants Pass, OR Micro Area","Grants Pass, OR Metro Area","Rome, GA Metro Area","Pascagoula, MS Metro Area","Dayton-Kettering, OH Metro Area","Dayton-Kettering-Beavercreek, OH Metro Area","Palm Coast, FL Metro Area","Walla Walla, WA Metro Area","Watertown-Fort Drum, NY Micro Area","Watertown-Fort Drum, NY Metro Area","East Stroudsburg, PA Micro Area","East Stroudsburg, PA Metro Area","Altoona, PA Metro Area","Muncie, IN Metro Area","Elmira, NY Metro Area","Carson City, NV Metro Area","Sebring, FL Micro Area","Sebring, FL Metro Area","Sebring-Avon Park, FL Metro Area","Carbondale-Marion, IL Metro Area","Kankakee-Bradley, IL Metro Area","Kankakee, IL Metro Area","Lima, OH Metro Area","Lewiston, ID-WA Metro Area","Midland, MI Micro Area","Midland, MI Metro Area","Bloomsburg-Berwick, PA Micro Area","Bloomsburg-Berwick, PA Metro Area","Gadsden, AL Metro Area","Cumberland, MD-WV Metro Area","Cumberland, MD-WV Micro Area","Twin Falls, ID Micro Area","Twin Falls, ID Metro Area","Springfield, OH Metro Area","Bay City, MI Metro Area","Anniston-Oxford, AL Metro Area","Anniston-Oxford-Jacksonville, AL Metro Area","Johnstown, PA Metro Area","Pine Bluff, AR Metro Area","Pine Bluff, AR Micro Area","Danville, VA Metro Area","Danville, VA Micro Area","Mansfield, OH Metro Area","Battle Creek, MI Metro Area","Decatur, IL Metro Area","Hot Springs, AR Metro Area","Beckley, WV Micro Area","Beckley, WV Metro Area","Wheeling, WV-OH Metro Area","Anderson, IN Metro Area","Fairbanks, AK Metro Area","Fairbanks-College, AK Metro Area","Danville, IL Metro Area","Danville, IL Micro Area","Enid, OK Metro Area","Sandusky, OH Metro Area","Sandusky, OH Micro Area","Weirton-Steubenville, WV-OH Metro Area","Steubenville-Weirton, OH-WV Metro Area"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>CBSA<\/th>\n      <th>New Housing Units Permitted<\/th>\n      <th>NAME<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"searching":false,"info":false,"columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"CBSA","targets":1},{"name":"New Housing Units Permitted","targets":2},{"name":"NAME","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Thus, Houston-Sugar Land-Baytown, TX Metro Area permitted the largest number of new housing units in the decade from 2010 to 2019 (inclusive).</p>
</section>
<section id="in-what-year-did-albuquerque-nm-cbsa-number-10740-permit-the-most-new-housing-units" class="level3">
<h3 class="anchored" data-anchor-id="in-what-year-did-albuquerque-nm-cbsa-number-10740-permit-the-most-new-housing-units">2. In what year did Albuquerque, NM (CBSA Number 10740) permit the most new housing units?</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CBSA <span class="sc">==</span> <span class="dv">10740</span>, year <span class="sc">!=</span> <span class="dv">2020</span>, year <span class="sc">!=</span> <span class="dv">2021</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="st">`</span><span class="at">New Housing Units Permitted</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(new_housing_units_permitted)) <span class="sc">|&gt;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">Year</span><span class="st">`</span> <span class="ot">=</span> year) <span class="sc">|&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="st">`</span><span class="at">New Housing Units Permitted</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(<span class="at">options =</span> <span class="fu">list</span>(<span class="at">searching =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-235065ec9cc7f500fd6d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-235065ec9cc7f500fd6d">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13"],[2022,2023,2013,2014,2016,2015,2017,2018,2019,2012,2010,2009,2011],[2852,2834,2606,2543,2465,2295,2256,2186,2148,2084,1764,1692,1634]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Year<\/th>\n      <th>New Housing Units Permitted<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"searching":false,"info":false,"columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Year","targets":1},{"name":"New Housing Units Permitted","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Thus, Albuquerque, NM (CBSA Number 10740) permit the most new housing units in 2022, if excluding the Covid-19 period in 2020 and 2021.</p>
</section>
<section id="which-state-not-cbsa-had-the-highest-average-individual-income-in-2015" class="level3">
<h3 class="anchored" data-anchor-id="which-state-not-cbsa-had-the-highest-average-individual-income-in-2015">3. Which state (not CBSA) had the highest average individual income in 2015?</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>INCOME <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(HOUSEHOLDS <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>), <span class="fu">join_by</span>(GEOID <span class="sc">==</span> GEOID)) <span class="sc">|&gt;</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Total Income Per CBSA</span><span class="st">`</span> <span class="ot">=</span> household_income <span class="sc">*</span> households,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Name</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">str_extract</span>(NAME.x, <span class="st">", (.{2})"</span>, <span class="at">group=</span><span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, Name, <span class="st">`</span><span class="at">Total Income Per CBSA</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(POPULATION <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>), <span class="fu">join_by</span>(GEOID <span class="sc">==</span> GEOID)) <span class="sc">|&gt;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Population =</span> population) <span class="sc">|&gt;</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, Name, <span class="st">`</span><span class="at">Total Income Per CBSA</span><span class="st">`</span>, Population) <span class="sc">|&gt;</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Average Individual Income</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Total Income Per CBSA</span><span class="st">`</span> <span class="sc">/</span> <span class="st">`</span><span class="at">Population</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="st">`</span><span class="at">Average Individual Income</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(<span class="at">options =</span> <span class="fu">list</span>(<span class="at">searching =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-99d2f704e22c1ef15226" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-99d2f704e22c1ef15226">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438","439","440","441","442","443","444","445","446","447","448","449","450","451","452","453","454","455","456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","471","472","473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489","490","491","492","493","494","495","496","497","498","499","500","501","502","503","504","505","506","507","508","509","510","511","512","513","514","515","516"],[41940,47900,41860,14860,12700,15680,14460,42660,31700,33260,45860,14500,25540,13900,33460,12580,19740,11260,31540,15540,34900,21820,40340,18180,35980,37100,42220,22660,24640,38860,14740,45940,33500,36020,28580,14010,24060,10580,25740,16820,12420,39580,35620,36500,48020,49340,28300,24540,19780,38900,44100,37980,11460,46520,11540,28140,16940,28180,16300,34940,36540,43100,33220,36140,42020,43620,25420,14580,35300,28740,40060,22020,13740,17200,10900,16980,23900,22540,38300,39300,20220,13460,22300,41740,42140,46020,17820,44620,34580,37900,46700,19340,16540,26620,47260,33340,48140,40900,27980,49020,41180,18140,42100,24580,45540,38340,24220,39540,33980,13180,17140,39900,45900,12300,49620,29540,35840,34980,31820,48580,45060,27500,14660,19100,30300,33780,49220,36780,12060,23180,36220,15380,26980,12180,39660,25940,30700,24020,40380,41620,30340,26420,41540,18700,30460,48900,38240,20500,27060,21300,17460,20260,18880,16220,36860,18020,19820,41060,28420,16700,13380,10420,42200,40220,26900,45820,39140,31140,47940,39740,25180,31940,36260,16740,24300,24340,20100,37020,19380,30140,31860,47020,48700,26090,31080,29620,27620,43580,47700,20740,12100,37140,37340,48300,29100,17860,46140,22060,15940,19500,16580,13820,12940,28020,40420,44140,11180,38820,27260,44300,42540,29020,13980,13780,23060,25900,48620,38060,41780,36420,31020,30620,35660,44420,48540,49300,44980,28940,32740,21780,47580,29940,20700,45300,17900,34820,24260,44220,21660,11020,39460,18500,24500,15980,30780,46540,29200,27100,13020,45780,21060,14260,28100,42340,22220,11100,37860,36980,21500,44060,35100,48060,13140,17660,35420,11700,31340,42680,41100,26740,10740,41420,27780,46060,16500,19300,35380,39500,38940,19460,16620,17220,24860,16860,32100,41700,10540,43300,41660,28060,23580,39060,14100,39820,48260,10300,36740,28900,29820,37460,18580,42860,41140,22140,33540,29340,49660,26860,47460,32820,33140,29180,49180,31740,12260,24660,27180,41500,44180,46100,43780,35260,39340,19180,24420,16180,26380,15260,33860,22380,27460,11980,22420,16020,38460,49700,31900,33100,34740,32780,23540,40980,26140,19660,17020,12220,46340,25500,37620,43420,26820,27900,22520,34180,28660,12620,16660,28700,31180,25840,20180,12980,10140,27140,29380,31260,14700,40700,49780,43740,43900,46380,11780,41400,48660,14020,40140,17780,27740,29420,43340,33700,34060,20380,21140,26020,30980,17300,10180,25060,45220,42940,47220,19260,23460,44700,17060,47380,35900,26580,46300,46220,48980,14540,36300,11500,21020,17420,24780,20020,18300,36460,16060,21700,22100,27340,30020,45460,30860,15500,40080,43060,34620,22900,33660,44940,25860,49420,25620,24140,25220,19140,19060,29460,18260,12540,34100,26300,22180,14140,39980,44660,17340,39380,32020,10780,17980,34340,34780,38540,31420,13220,22500,10500,24940,12020,40660,23420,36100,46180,43140,10700,40580,32300,36700,32220,32940,31980,34860,27860,49740,42620,18980,39020,42700,29300,34380,45500,29740,22580,31460,30940,21340,24620,10460,33740,38220,25980,40740,40780,45180,25260,11900,46660,26660,47300,32900,37260,44340,40260,29860,43320,36660,31300,29700,20940,15180,32580,41980,23700,25020,11640,32420,38660,10380,41900],["CA","DC","CA","CT","MA","MD","MA","WA","NH","TX","CT","CO","CT","ND","MN","MD","CO","AK","WI","VT","CA","AK","MN","NH","CT","CA","CA","CO","MA","ME","WA","NJ","ND","WA","FL","IL","CO","NY","MT","VA","TX","NC","NY","WA","WI","MA","NH","CO","IA","OR","IL","PA","MI","HI","WI","MO","WY","HI","IA","FL","NE","WI","MI","NJ","CA","SD","PA","MT","CT","NY","VA","ND","MT","NH","PA","IL","PA","WI","PA","RI","IA","OR","OH","CA","NM","CA","CO","WI","WA","IL","CA","IA","PA","AL","VA","WI","WI","CA","HI","VA","MO","OH","CA","WI","FL","MA","ND","WI","NC","WI","OH","NV","MI","ME","PA","PA","FL","TN","WI","WI","NY","WI","MN","TX","ID","MI","WI","WI","GA","KY","TX","NY","IA","NY","SD","SC","NE","NY","NY","UT","ME","TX","MD","OR","KY","NC","NC","NC","NY","NY","OH","MN","FL","WY","IL","IN","MI","MN","WA","SC","WA","OH","CA","VA","IN","KS","AZ","KY","IA","PA","MD","WI","UT","NC","CO","MI","DE","MI","OH","PA","MN","TX","PA","MI","CA","MI","MO","IA","IN","WI","NJ","KY","FL","WA","WI","MO","OK","MN","OH","IL","IL","AL","LA","MI","IL","MA","IA","WA","FL","PA","PA","IN","VA","NY","IN","HI","KS","AZ","OH","OK","WA","OH","MI","VA","WV","OH","PA","TN","PA","IN","GA","KS","PA","FL","SC","SC","NE","OH","OR","PA","FL","NY","MT","FL","AR","NY","IN","MI","MI","OH","KY","ID","IL","GA","AR","TX","FL","KY","PA","WA","NC","NY","TX","ID","OH","NC","VA","FL","UT","KS","NM","OR","PA","AZ","WA","AL","LA","IL","FL","AL","WV","WV","SC","TN","MI","TX","OR","TX","TX","MT","GA","PA","PA","CA","WV","MI","FL","OR","NV","FL","TX","SC","MO","NM","MT","LA","OH","PA","WA","TN","IN","LA","NC","KS","GA","NC","TN","CA","MO","TN","IN","PA","UT","IL","OR","NV","LA","GA","AL","AZ","NY","TX","MI","MO","NY","CA","OH","FL","MI","OR","FL","MI","FL","FL","CA","AL","TX","VA","WV","AZ","ID","MO","AL","WA","TX","ME","IL","TN","TX","OR","PA","MI","WA","MS","FL","TX","MO","OR","OH","PA","SC","CA","OH","OH","TX","IN","CA","TX","TN","AZ","LA","CA","WV","NC","IN","NM","TX","TN","TX","MS","FL","TN","NJ","VA","AL","CA","OH","TX","NC","WV","ID","AL","NC","KY","NY","AL","NC","TN","NC","AL","OR","NY","IL","CA","MO","NC","OK","IN","UT","NC","KY","OK","IN","AR","AL","SC","NC","WA","MS","NC","LA","GA","MD","FL","TN","CA","TN","AR","NC","WV","IN","OK","CA","CO","OH","LA","GA","NC","OK","ID","GA","WV","SC","GA","SC","GA","GA","CA","FL","MS","NC","AL","NC","VA","SC","TX","MS","IN","TX","AR","AZ","AR","AL","OH","FL","GA","MI","TX","NM","NC","CA","KY","TX","TN","NM","LA","AR","GA","NM","AR","AL","CA","OH","GA","TX","CA","CA","FL","GA","NC","MS","AZ","LA","NC","TX","CA","TX","TX","PR","NM","PR","PR","PR","PR","PR","PR"],[66424876960,202663489140,149587187826,28821488592,6441706002,3323826727,140473214000,108267370482,11644778994,4673396787,5184131120,8973401535,33579904575,3590510916,96199224128,75235366360,75618815077,10609151038,16963755160,5715539271,3746879547,2588788125,5474473086,3787243010,6929947264,21573906112,12712198188,8388183990,1770522891,13174585760,6509204100,9266841405,2003942374,1993863548,1915478820,4645590814,1918670135,21621679280,1931367398,5621524182,48643401230,30950325006,489798343295,6534264783,2043754447,22589914863,1832209460,6872582432,15011172528,57554517700,5093195744,145468631496,8558961723,23777133919,5541998805,49254194184,2287006260,1686434680,6241601790,8381170156,21446640704,2706195586,1955272284,2210846128,6563004480,5881049412,13134464460,2341214220,19965155200,4158798252,29332089551,5388855242,3894134229,4984897928,19110454935,219203620929,2346883557,2321797900,53558398400,36712021755,2209872808,3983063152,1717260801,74968225200,3376303992,2241898437,15805837230,1594588864,2745054832,8488507650,9813091386,8643668488,3447808560,9971951808,38634450723,35314228974,3038171346,50834246835,3676315560,2976544240,62600278349,44941914368,6078576063,7008294813,2626811950,2817305205,2253477538,4290110720,1512858528,1943232760,47313725382,9882638881,3244816638,2624296535,9676735848,11716452972,16780463906,39814820400,1735821416,2230610922,14318290371,3498408958,1989019374,152876811780,1337043190,3203162856,1572644160,3630542496,122166586395,1527183780,3405113442,24228881824,3551373756,1667083728,3094501782,4408074552,6875318632,2693849404,22943715840,24807399936,2272156644,140938753280,8365006386,1853096824,10586164983,5873454630,1991724533,11660323040,2213697408,1835048974,43364849275,5876375992,5494768752,1722179704,3176170288,1694989557,89786732628,4041032869,5793889703,15446132460,4402545368,14569080480,9178606125,6436322883,41018542200,4809712572,4566126600,26261476590,3500353430,8518870624,5360298678,1319524369,13183951770,49664745856,3039831690,21251556046,3547319106,1401519204,16357606720,2796777200,2018194668,2009768466,2354117705,2324864750,269917200528,9532570032,3053465912,3330408204,1579605896,3326410276,5503196276,1978083990,11377983712,2326199976,2738475640,3493559040,19556947032,1303811635,8031509684,2134369160,4761028800,22732630758,16461504090,6641067264,6746448840,12473619267,1893421104,1448106599,28542369079,3161407092,10987004000,1624372202,3535518012,4834049838,8434823592,3854178633,12615134502,89359680934,1467968544,26375469354,2007300463,2025057688,2998551071,2330636512,2783046238,2239081640,1798705209,16611040442,1666464294,6079635632,3614024148,2267759588,3191523558,57064659344,15546005946,8282228232,1628614813,2601129416,6936913436,2400172560,3305949132,1863068482,1567706250,13356364794,13881458324,5606972300,4060584072,3011025636,1992721440,11426692613,2785490545,12727284825,2086956750,7132109760,9693397680,4947115484,8983248000,2216362665,5218999268,10253821296,2345118623,2205011515,7631500721,2808185500,1728102141,8292047958,4832900730,2740238226,2880351589,1179378144,16765326830,7583980800,2520146876,18650827208,1400948962,3758204807,23289433622,1425345534,8348123824,2801591429,4020110358,1681707065,16031413200,10008336060,1230507982,43585690659,2201213005,2287813788,2186481417,1749660993,3519970901,2629127520,1547240320,3259124707,2202972948,1787095464,43175132715,1193033088,38198279232,3570150216,8122593402,1362359808,2291616234,2134847390,2051266650,3691524337,9862799884,1553771340,1144295883,23983957480,1978780622,8750229740,11745187826,1752621324,10483871734,13316984912,2295900854,7676930576,8050373072,1812728232,5640953258,1551079098,10302110840,1394745846,1490345574,958548437,3731532212,2068654509,6588880044,2440261472,2293202340,1394208318,7197559200,1686895952,1417985873,2982140470,2121788295,104784216642,2999741395,3686182448,4799079831,3349644813,2439439054,10775032392,3892931116,2711060499,3845322800,2257192000,1595483903,2173294782,2403197979,3040757071,2520365661,1597285305,7370697276,2610580127,1076742226,5226569040,5336931223,1520528471,1381474714,2286726384,1210266460,9839683351,1158770304,1495627936,1449519786,1824737688,1462132250,1274828340,5484567960,1477420544,1661729163,1764112892,2535905242,2782463952,75354342762,4195065366,3355192712,3428131308,7425920052,9004341480,2309637834,2140776000,3394486888,1187142260,3631492332,4665278550,2815420240,6481994784,6302957025,1593581522,2585249700,1727572914,1704884872,11979544710,1271945868,4317618373,1126909260,5944224195,1720947480,3944791830,1331878096,2714812500,1802541024,1876901758,1034011139,1965965820,2834307422,2378404716,1011085764,1247458784,2030139408,2168039652,1060473483,2968584472,2079815326,2732351190,2109991485,2494760313,1622748270,1131050187,1838558468,4406670000,6530299662,1688628873,5657116860,3858544107,2297363640,1916743890,1987551006,2219129792,1541640960,10007222442,1654865058,13516962366,1784787534,1485479742,5749800518,1588379670,1021874080,1230099840,982137490,2478133800,989348948,2327379868,4699188936,1091509858,1043365008,1253126220,3461788800,1820546070,3041686668,2312116371,1384820550,2964072672,1415054810,14282308341,5015341350,2036868948,1411175535,1376715300,2144263800,942913510,1280422300,954827466,1498229408,971419365,936548445,1829391454,2908713789,1126500470,1166073876,1092082341,1407894072,980269164,990158148,2113034160,2977926162,916367530,2132311600,1747029578,11411294857,926914880,864480498,2360854430,1244447742,1037219414,862267260,1109327328,1189701282,1952988232,830880827,1785564000,1100817934,5717314813,3321878706,886718695,886973115,878656485,1019551653,1277696076,924086432,1431881134,2874029466,1844794616,4172974632,8063975160,16479952099,556763820,433289290,1050981750,522669120,1645888016,1587353210,633069462],[1976836,6098283,4656132,948053,214333,111413,4774321,3733580,406678,165427,183603,319372,1211324,129640,3524583,2797407,2814330,399790,641385,216661,142456,99631,213873,147994,271863,850536,502146,333577,70601,526295,260131,371398,80737,80593,77482,188725,78056,881830,78834,230602,2000860,1273568,20182305,269536,84559,935536,75909,285174,622899,2390244,211598,6069875,358880,998714,233007,2088269,97121,71735,266040,357305,915557,115569,83632,94727,281401,252234,565006,100739,859470,180143,1271142,233836,169329,216923,832327,9550108,102295,101973,2353045,1613070,97125,175268,75573,3299521,148686,98877,697856,70408,121846,376987,436092,384584,153638,444752,1723351,1575747,135868,2274194,164726,133621,2812313,2021632,274146,316519,118891,127828,102449,195080,68879,88502,2159329,451138,148334,119980,442867,536624,768918,1830298,79806,102804,660458,161448,92134,7102165,62153,149568,73435,169546,5709731,71505,159436,1135230,166498,78288,145457,207413,323557,126918,1081954,1170266,107233,6656946,395300,87572,500535,277969,94352,552493,104926,87071,2060810,279601,262172,82178,151595,81162,4302043,194418,279116,744526,212284,704243,444769,311901,1988152,233791,222255,1279335,170612,415271,261486,64432,644030,2426363,148513,1038583,173533,68619,800909,137067,99134,99040,116048,114625,13340068,472276,151357,165491,78620,165636,274219,98597,568088,116178,136985,174974,980794,65400,402976,107303,239672,1145647,830480,335340,340663,631982,96021,73486,1449481,160580,558166,82556,179904,246020,429820,196428,644502,4574531,75550,1358452,103468,104425,154636,120221,144198,116063,93246,861679,86484,315693,187953,118053,166397,2975225,810574,431964,84942,135959,362895,125593,173115,97631,82278,701982,730250,295600,214997,159494,105659,605956,147877,675800,110879,379199,515403,263258,478043,117967,278045,546807,125066,117635,408216,150346,92916,446840,260504,147919,155602,63718,906209,410091,136411,1010025,75882,203709,1262888,77450,454846,152680,219236,91756,874869,546351,67215,2381828,120547,125467,120106,96165,193535,144590,85229,179533,121403,98573,2387138,66016,2114801,197723,450436,75713,127421,118737,114181,205493,549885,86966,64056,1343572,110884,490488,659330,98545,590772,752157,129682,433898,455074,102576,320098,88082,585257,79282,84745,54521,212297,117771,375435,139097,130779,79545,410849,96542,81251,170955,121707,6012331,172790,212567,276881,193307,141058,623279,225411,156993,222936,131131,92776,126427,139849,177211,146950,93259,430642,152692,62998,305929,312433,89094,80994,134314,71122,578561,68348,88255,85535,107685,86290,75522,325079,87649,98632,104806,150780,165577,4489159,250145,200264,204737,443708,538388,138176,128140,203474,71180,217781,279887,168922,389255,378593,95946,155854,104276,103057,726106,77170,262425,68502,361580,105312,241851,81714,166890,111007,115620,63938,121678,175842,148171,63121,77922,126828,135727,66520,186311,130581,172107,133821,158276,102997,71875,116852,280241,415395,107480,362510,248830,148610,124132,128755,143781,99979,650092,107851,882176,116642,97177,376509,104063,67001,80850,64591,163591,65355,154484,312936,72743,69699,83744,231448,122507,206448,156997,94211,201813,96504,974861,343254,139817,96879,94725,148069,65553,89208,66746,104782,67979,65664,128394,204275,79161,82005,76825,99491,69763,70698,151316,214295,66390,154998,127953,838019,68580,64362,179238,94489,78811,65764,85103,91770,150965,65886,142202,87693,459863,268455,72023,72651,72882,85637,108277,83848,134197,269721,180191,422156,842304,2200767,76708,77367,188295,98464,318802,313209,128611],[33601.61235428735,33232.87704752305,32126.92162206742,30400.71450857705,30054.66261378322,29833.38324073492,29422.65800728522,28998.27256466983,28633.90445020385,28250.50800050778,28235.54691372145,28097.02019901557,27721.65380608326,27696.01138537488,27293.78883345916,26894.68009481638,26869.20690786084,26536.80941994547,26448.63094709106,26380.10196112821,26302.01288117033,25983.76132930514,25596.84058296278,25590.51725069935,25490.58630265979,25365.07109869541,25315.74121470648,25146.17011964254,25077.87270718545,25032.70173571856,25022.79274673145,24951.24207723251,24820.61971586757,24739.90976883849,24721.59753233009,24615.66201616108,24580.68739110382,24519.10150482519,24499.16784636071,24377.60375885725,24311.24677888508,24302.05925871253,24268.70187993889,24242.64210717678,24169.56736716376,24146.49448337637,24136.91999631137,24099.61087616683,24098.88686287825,24078.92989167633,24070.15068195352,23965.67169768735,23849.09084652251,23807.75068638269,23784.68803512341,23586.13482458438,23548.0098022055,23509.23091935596,23461.14039242219,23456.62712808385,23424.69196784034,23416.27586982668,23379.47536828008,23339.13380556758,23322.60539230493,23315.84723708937,23246.59288573927,23240.3956759547,23229.61266827231,23086.09411412045,23075.38382887199,23045.44741613781,22997.44420034371,22980.0340581681,22960.27274736972,22952.99916283669,22942.30956547241,22768.75153226835,22761.31497697664,22759.10019713961,22752.87318404119,22725.55829929023,22723.20539081418,22720.94197915394,22707.6119607764,22673.60899905944,22649.13854720745,22647.83638222929,22528.88754657518,22516.71184948022,22502.34213422856,22475.37205916003,22441.11847329437,22421.37597582473,22418.21354036409,22411.10341571331,22361.19870756911,22352.64310564534,22317.76137343224,22276.0212840796,22259.35674620855,22230.51196656958,22172.76948414349,22141.78236693532,22094.28762479918,22039.81291266389,21996.09110874679,21991.5456223088,21964.00249713265,21956.93611443809,21911.30919929293,21906.0218403238,21875.07003114593,21872.78325554259,21850.2075069942,21833.63578967769,21823.47650334626,21753.19013625104,21750.51269328121,21697.70555620404,21679.33520526665,21668.95197215202,21588.33192958083,21525.38159561204,21512.12636558171,21416.09740051348,21415.45802410295,21413.31848583865,21396.20700082018,21357.72015942941,21357.24329511528,21342.70749011213,21329.82832226213,21294.24340895156,21274.3407467499,21252.64352764774,21249.17288762104,21225.1170361966,21205.81451706819,21198.08653417257,21188.96835862095,21171.68342359995,21161.15959018467,21160.83707120997,21149.69978722767,21129.89085113808,21109.51048202476,21104.92447868118,21097.70131330652,21075.31754545141,21042.62366496669,21017.00634833209,20958.64070915277,20956.70013872326,20951.68236419407,20884.02894211577,20870.71947630463,20785.28155314837,20757.99919388355,20746.26334070268,20738.941078932,20687.57585094918,20636.79376260486,20635.78790385411,20631.49205895726,20572.70199451647,20544.53938044138,20527.44323418026,20516.45505591635,20514.00320272786,20499.37158394713,20479.33276943134,20471.02117913762,20468.80283617909,20468.4552194084,20462.0680735194,20441.75520506186,20424.65212258995,20423.80185514209,20404.453296563,20358.24911735631,20292.49258885299,20285.72405383979,20282.35332606325,20233.570063361,20184.32025341114,20173.93257001658,20124.40678949308,20091.65474433986,20082.65278079644,20068.61769607503,20062.31416777387,20028.55844869105,20022.72354490523,19991.06208708983,19966.16091533599,19939.91300109911,19935.95772171254,19930.49135432383,19891.04833974819,19864.7685169732,19842.61361309374,19821.67432087467,19803.98182143496,19803.87902413822,19737.30148485242,19718.82300746712,19705.88410037286,19691.44064599674,19687.42740067256,19684.11547819108,19676.00419109453,19652.24793223052,19649.01161694171,19624.08355125401,19621.33012096035,19573.46059748457,19534.17321557117,19430.42414295169,19415.82724601237,19400.20550315073,19392.46050275317,19391.02842158359,19386.26788996931,19300.17224926837,19291.95040624488,19289.89135190786,19277.52729496715,19269.0473844873,19258.06283953081,19228.33978707443,19209.67351952089,19180.17487094118,19179.94751455772,19179.00888259431,19173.42239631081,19173.25719902993,19131.7192388882,19115.48364127365,19110.71922798245,19096.83812494584,19082.75529288853,19053.77196820535,19026.6485379967,19009.18633892502,18968.10656292287,18886.70107954995,18878.61384127303,18859.93090981365,18857.29758101248,18836.53675013694,18832.91628440367,18821.92976127129,18808.35592920868,18807.41415940536,18791.89040409029,18791.71538961976,18787.98871718362,18770.34029743387,18752.17635472845,18751.04843042873,18744.51919071705,18694.7614032767,18678.15239514187,18598.54213483146,18557.08521618477,18552.11716518748,18525.26197445899,18511.0190678783,18509.34028061144,18500.50797332624,18493.40951154744,18474.66022534839,18465.70848048316,18462.20397459213,18448.88938142154,18441.40859838719,18403.42845706908,18353.73692194721,18349.43299056851,18336.90798044117,18328.03375256114,18324.35850395888,18318.50963940763,18307.04429070892,18299.26034079707,18260.20560445304,18234.38663552966,18204.59774699016,18194.3637810014,18187.77430955641,18183.32886091707,18153.91850191836,18153.346220472,18145.95148390073,18129.66495896442,18086.5675612386,18071.87784779447,18062.3516028222,18056.32230949359,18032.73584260583,17993.73698043929,17984.60406055517,17979.63052797359,17965.04365875233,17964.23399823838,17936.11370377443,17866.42296989628,17863.99217871862,17850.8911171117,17845.50180368674,17839.84468529301,17813.82285956956,17784.98476837993,17746.05386511209,17705.06012973355,17704.08271001372,17692.9383772223,17690.25053507781,17672.05030416472,17622.58201550775,17609.48999795645,17602.71272278674,17592.21318836558,17586.23604932445,17581.27028117606,17576.94273588416,17565.05853733092,17549.98879699548,17543.59527523958,17534.94322482968,17527.29043937394,17518.74581658955,17473.18215906031,17451.91902868888,17444.00848176421,17433.57649929749,17428.21821386747,17360.61921986226,17341.27333029115,17332.64409981183,17328.10924074141,17293.87240709495,17287.6551143228,17270.36886398623,17268.67120827043,17248.55025657588,17213.26002242033,17197.1620138829,17190.1158929659,17184.23427410993,17158.96344470716,17151.17836679142,17127.41188517998,17115.60246329898,17097.03276530532,17091.68903774723,17084.25497419336,17081.84226058067,17066.56420185422,17056.50682766625,17025.22733296603,17016.76640139479,17007.16666176946,16953.97530286183,16946.66518610844,16946.51062138306,16945.14266610948,16944.39969869046,16880.22483514738,16871.49265255523,16856.10268228959,16847.76911144456,16832.17460832395,16818.57833930229,16804.65253024273,16785.84847674141,16770.5345539587,16753.84848000639,16744.07316703869,16736.05175475763,16724.63256981954,16715.18812239463,16706.53972217887,16682.65669323845,16678.0311885361,16674.97317029493,16668.43601167614,16666.98381501521,16652.3096273651,16648.37180032383,16609.15016780272,16587.63778921298,16567.31092485327,16543.12537721843,16498.34144050593,16482.38781910069,16452.77078403354,16450.74975913112,16439.58237457824,16341.41864175023,16310.83530768945,16299.26445896664,16267.07711666367,16238.08430099003,16233.36583636049,16172.09075979856,16157.11813146173,16118.48945075693,16051.75584966019,16018.21523740118,16009.07040373707,16007.02847951556,15973.53254695086,15942.17503006615,15933.49008915201,15927.39622150236,15875.88645435688,15767.26735714126,15762.08845940003,15755.29646494558,15736.35042782609,15734.07787628795,15724.57277842999,15720.69876141985,15711.09855787123,15605.40911974842,15506.74800868062,15459.01110288675,15441.17463667709,15436.689883888,15434.09624359269,15419.64772602247,15393.54805473687,15343.99363937284,15322.29664602075,15301.41401896401,15286.33053088694,15271.34947106178,15263.63520175278,15251.62430411486,15214.59294990724,15205.48512950721,15148.35045937735,15138.07586259659,15065.50754770721,15016.45363908275,15005.0157128521,14969.58360952094,14963.77316583875,14957.09100964363,14860.75138563511,14733.42763310858,14727.13727650847,14699.1386356158,14687.22367736469,14663.17261460665,14650.61002645505,14611.16651226206,14568.10651065321,14566.37181432509,14533.81155977831,14481.51740067131,14383.98715543148,14353.22280512958,14305.38857759266,14298.53799316676,14289.99198281822,14262.73825840643,14248.26280044239,14239.20591849223,14230.49822513611,14219.54607645875,14215.19480637813,14150.96915298871,14051.4192910282,14005.46193668845,13964.38023738402,13896.38657924823,13802.79454737159,13757.02654227796,13653.68203949888,13616.98822699724,13515.81918926801,13431.53565768621,13171.61779310191,13170.29222449174,13160.84574488333,13111.53913995499,13035.11424979143,12963.94553775744,12936.6954724605,12610.88587863886,12556.53225693028,12553.08786334143,12432.64801256026,12374.06159691568,12311.60455687766,12208.684188793,12055.87778875443,11905.50408117986,11800.2537565688,11020.97166300926,10669.99362131791,10655.56432758295,10237.9953271806,9884.911340831351,9573.711106678824,7488.276632192322,7258.223653334724,5600.440627140771,5581.570142595396,5308.225544361391,5162.728012998664,5068.031921177233,4922.358600741772]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>GEOID<\/th>\n      <th>Name<\/th>\n      <th>Total Income Per CBSA<\/th>\n      <th>Population<\/th>\n      <th>Average Individual Income<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"searching":false,"info":false,"columnDefs":[{"className":"dt-right","targets":[1,3,4,5]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"GEOID","targets":1},{"name":"Name","targets":2},{"name":"Total Income Per CBSA","targets":3},{"name":"Population","targets":4},{"name":"Average Individual Income","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>From the table above, we can conclude that CA is the state that had the highest average individual income in 2015.</p>
</section>
<section id="what-is-the-last-year-in-which-the-nyc-cbsa-had-the-most-data-scientists-in-the-country" class="level3">
<h3 class="anchored" data-anchor-id="what-is-the-last-year-in-which-the-nyc-cbsa-had-the-most-data-scientists-in-the-country">4. What is the last year in which the NYC CBSA had the most data scientists in the country?</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> INCOME  <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(<span class="st">"C"</span>, GEOID))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>t2 <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(FIPS, <span class="st">"0"</span>))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(t1, t2, <span class="fu">join_by</span>(std_cbsa <span class="sc">==</span> std_cbsa)) <span class="sc">|&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(INDUSTRY <span class="sc">==</span> <span class="dv">5182</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR, std_cbsa) <span class="sc">|&gt;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="st">`</span><span class="at">Employment Number</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(EMPLOYMENT)) <span class="sc">|&gt;</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(YEAR, <span class="fu">desc</span>(<span class="st">`</span><span class="at">Employment Number</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">Employment Number</span><span class="st">`</span> <span class="sc">==</span> <span class="fu">first</span>(<span class="st">`</span><span class="at">Employment Number</span><span class="st">`</span>))<span class="sc">|&gt;</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(std_cbsa <span class="sc">==</span> <span class="st">"C35620"</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="st">`</span><span class="at">Employment Number</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(<span class="at">options =</span> <span class="fu">list</span>(<span class="at">searching =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in inner_join(t1, t2, join_by(std_cbsa == std_cbsa)): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 2 of `x` matches multiple rows in `y`.
ℹ Row 1 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'YEAR'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-8aa749e51253dab0b806" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8aa749e51253dab0b806">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5"],[2015,2014,2009,2012,2013],["C35620","C35620","C35620","C35620","C35620"],[264908,249592,228886,201922,199514]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>YEAR<\/th>\n      <th>std_cbsa<\/th>\n      <th>Employment Number<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"searching":false,"info":false,"columnDefs":[{"className":"dt-right","targets":[1,3]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"YEAR","targets":1},{"name":"std_cbsa","targets":2},{"name":"Employment Number","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Thus, 2015 is the last year in which the NYC CBSA had the most data scientists in the country.</p>
</section>
<section id="what-fraction-of-total-wages-in-the-nyc-cbsa-was-earned-by-people-employed-in-the-finance-and-insurance-industries-naics-code-52-in-what-year-did-this-fraction-peak" class="level3">
<h3 class="anchored" data-anchor-id="what-fraction-of-total-wages-in-the-nyc-cbsa-was-earned-by-people-employed-in-the-finance-and-insurance-industries-naics-code-52-in-what-year-did-this-fraction-peak">5. What fraction of total wages in the NYC CBSA was earned by people employed in the finance and insurance industries (NAICS code 52)? In what year did this fraction peak?</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>WAGES <span class="sc">|&gt;</span>  </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(FIPS <span class="sc">==</span> <span class="st">"C3562"</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR) <span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Total Wages</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(TOTAL_WAGES),</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Finaance and Insurance Wages</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(<span class="fu">ifelse</span>(INDUSTRY <span class="sc">==</span> <span class="dv">52</span>, TOTAL_WAGES, <span class="dv">0</span>)),</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Fraction</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Finaance and Insurance Wages</span><span class="st">`</span> <span class="sc">/</span> <span class="st">`</span><span class="at">Total Wages</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="st">`</span><span class="at">Fraction</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(<span class="at">options =</span> <span class="fu">list</span>(<span class="at">searching =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-40beeca4f5f337e32592" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-40beeca4f5f337e32592">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14"],[2014,2011,2010,2009,2021,2012,2017,2013,2018,2015,2016,2022,2023,2019],[2587096519796,2452875238158,2366455158958,2194200174111,3636399927489,2543568475824,3176952501734,2663041532424,3196707717054,3008221071967,3038312046515,4104601808975,4160135177511,3617150803059],[119105615711,108996581223,103632250413,94479998021,156065553132,107816036343,130116071763,107314017412,128706315380,119431006954,118586163642,159178860174,160765698817,132713121248],[0.04603833478945417,0.04443625159869589,0.04379218850638669,0.04305896933914857,0.04291759879111154,0.04238770741490359,0.04095625341958429,0.04029753802386956,0.04026214679977445,0.03970153924754841,0.03903027793936456,0.03878058520218557,0.03864434494486445,0.03668996082103224]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>YEAR<\/th>\n      <th>Total Wages<\/th>\n      <th>Finaance and Insurance Wages<\/th>\n      <th>Fraction<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"searching":false,"info":false,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"YEAR","targets":1},{"name":"Total Wages","targets":2},{"name":"Finaance and Insurance Wages","targets":3},{"name":"Fraction","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Thus, the fractions of total wages in the NYC CBSA was earned by people employed in the finance and insurance industries are shown in the table above. This fraction peaks in 2014.</p>
</section>
</section>
<section id="task-3-initial-visualizations" class="level2">
<h2 class="anchored" data-anchor-id="task-3-initial-visualizations">Task 3: Initial Visualizations</h2>
<section id="the-relationship-between-monthly-rent-and-average-household-income-per-cbsa-in-2009." class="level3">
<h3 class="anchored" data-anchor-id="the-relationship-between-monthly-rent-and-average-household-income-per-cbsa-in-2009.">The relationship between monthly rent and average household income per CBSA in 2009.</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>Q1 <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(RENT <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>), <span class="fu">join_by</span>(GEOID <span class="sc">==</span> GEOID)) <span class="sc">|&gt;</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NAME.x, household_income, monthly_rent)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Q1, <span class="fu">aes</span>(<span class="at">x =</span> household_income, <span class="at">y =</span> monthly_rent)) <span class="sc">+</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make points slightly transparent so plot is less busy</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span> </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Average Household Income (USD)"</span>) <span class="sc">+</span> </span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Monthly Rent (US Dollars)"</span>) <span class="sc">+</span> </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"The Relationship Between Monthly Rent And Average Household Income In 2009"</span>) <span class="sc">+</span> </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>, </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">color=</span><span class="st">"red4"</span>) <span class="sc">+</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Format y axis as dollars</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels=</span>scales<span class="sc">::</span>dollar) <span class="sc">+</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels=</span>scales<span class="sc">::</span>dollar) <span class="sc">+</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="the-relationship-between-total-employment-and-total-employment-in-the-health-care-and-social-services-sector-naics-62-across-different-cbsas." class="level3">
<h3 class="anchored" data-anchor-id="the-relationship-between-total-employment-and-total-employment-in-the-health-care-and-social-services-sector-naics-62-across-different-cbsas.">The relationship between total employment and total employment in the health care and social services sector (NAICS 62) across different CBSAs.</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR, FIPS) <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_employment =</span> <span class="fu">sum</span>(EMPLOYMENT))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'YEAR'. You can override using the
`.groups` argument.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>t2 <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(INDUSTRY <span class="sc">==</span> <span class="dv">62</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR, FIPS) <span class="sc">|&gt;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">health_and_social =</span> <span class="fu">sum</span>(EMPLOYMENT))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'YEAR'. You can override using the
`.groups` argument.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>t3 <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(t1, t2, <span class="fu">join_by</span>(YEAR <span class="sc">==</span> YEAR,</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                                 FIPS <span class="sc">==</span>FIPS)) <span class="sc">|&gt;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fraction =</span> health_and_social <span class="sc">/</span> total_employment)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(t3, <span class="fu">aes</span>(<span class="at">x =</span> YEAR, <span class="at">y =</span> fraction, <span class="at">group =</span> FIPS)) <span class="sc">+</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span> </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span> </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Fraction of Employment In Health Care And Social Services"</span>) <span class="sc">+</span> </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Total Employment vs Employment In Health Care and Social Services"</span>) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="the-evolution-of-average-household-size-over-time.-use-different-lines-to-represent-different-cbsas." class="level3">
<h3 class="anchored" data-anchor-id="the-evolution-of-average-household-size-over-time.-use-different-lines-to-represent-different-cbsas.">The evolution of average household size over time. Use different lines to represent different CBSAs.</h3>
<p>Note that Extra Credit Opportunity #02 is also included.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gghighlight)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>Q3 <span class="ot">&lt;-</span> POPULATION <span class="sc">|&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(HOUSEHOLDS, <span class="fu">join_by</span>(GEOID <span class="sc">==</span> GEOID,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                                 year <span class="sc">==</span> year)) <span class="sc">|&gt;</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">average =</span> population <span class="sc">/</span> households)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Q3, <span class="fu">aes</span>(<span class="at">x=</span>year, </span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">y=</span>average, </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">group=</span>GEOID,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">color=</span><span class="fu">case_when</span>(GEOID <span class="sc">==</span> <span class="dv">35620</span> <span class="sc">~</span> <span class="st">"New York"</span>,</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>                                    GEOID <span class="sc">==</span> <span class="dv">31080</span> <span class="sc">~</span> <span class="st">"Los Angeles"</span>))) <span class="sc">+</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"New York"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"Los Angeles"</span> <span class="ot">=</span> <span class="st">"red"</span>),</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="st">"Highlight"</span>) <span class="sc">+</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gghighlight</span>(GEOID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">35620</span>, <span class="dv">31080</span>), </span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">use_direct_label =</span> <span class="cn">FALSE</span>, </span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">unhighlighted_params =</span> <span class="fu">list</span>(<span class="at">alpha=</span><span class="fl">0.3</span>)) <span class="sc">+</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>) <span class="sc">+</span> </span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span> </span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Average Household Size"</span>) <span class="sc">+</span> </span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"The Evolution Of Average Household Size Over Time"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Tried to calculate with group_by(), but the calculation failed.
Falling back to ungrouped filter operation...</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="task-4-rent-burden" class="level2">
<h2 class="anchored" data-anchor-id="task-4-rent-burden">Task 4: Rent Burden</h2>
<section id="pick-a-single-metropolitan-area-and-see-how-rent-burden-has-changed-over-time" class="level3">
<h3 class="anchored" data-anchor-id="pick-a-single-metropolitan-area-and-see-how-rent-burden-has-changed-over-time">Pick a single Metropolitan Area and see how rent burden has changed over time</h3>
<p>I picked the rent-to-income ratio. My baseline is the average rent-to-income ratio in the first year of my study, which is 2009. I standardized my metric by dividing by the baseline value so that values can be interpreted as “k times baseline”.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>standard_ratio <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(RENT, <span class="fu">join_by</span>(GEOID <span class="sc">==</span> GEOID, year <span class="sc">==</span> year, NAME <span class="sc">==</span> NAME)) <span class="sc">|&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rent_to_income =</span> (<span class="dv">12</span> <span class="sc">*</span> monthly_rent) <span class="sc">/</span> household_income)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>baseline <span class="ot">&lt;-</span> standard_ratio <span class="sc">|&gt;</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">baseline =</span> <span class="fu">mean</span>(rent_to_income)) </span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>standard_ratio <span class="ot">&lt;-</span> standard_ratio <span class="sc">|&gt;</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">standardized_metric =</span> rent_to_income <span class="sc">/</span> baseline[[<span class="dv">1</span>]])</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>standard_ratio <span class="sc">|&gt;</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(GEOID <span class="sc">==</span> <span class="dv">35620</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NAME, year, rent_to_income, standardized_metric) <span class="sc">|&gt;</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Year =</span> year,</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Rent to Income Ratio</span><span class="st">`</span> <span class="ot">=</span> rent_to_income,</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Standardized Metric</span><span class="st">`</span> <span class="ot">=</span> standardized_metric) <span class="sc">|&gt;</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(<span class="at">options =</span> <span class="fu">list</span>(<span class="at">searching =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-76f8d27cb852bba24cff" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-76f8d27cb852bba24cff">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14"],["New York-Northern New Jersey-Long Island, NY-NJ-PA Metro Area","New York-Northern New Jersey-Long Island, NY-NJ-PA Metro Area","New York-Northern New Jersey-Long Island, NY-NJ-PA Metro Area","New York-Northern New Jersey-Long Island, NY-NJ-PA Metro Area","New York-Newark-Jersey City, NY-NJ-PA Metro Area","New York-Newark-Jersey City, NY-NJ-PA Metro Area","New York-Newark-Jersey City, NY-NJ-PA Metro Area","New York-Newark-Jersey City, NY-NJ-PA Metro Area","New York-Newark-Jersey City, NY-NJ-PA Metro Area","New York-Newark-Jersey City, NY-NJ-PA Metro Area","New York-Newark-Jersey City, NY-NJ-PA Metro Area","New York-Newark-Jersey City, NY-NJ-PA Metro Area","New York-Newark-Jersey City, NY-NJ-PA Metro Area","New York-Newark-Jersey City, NY-NJ Metro Area"],[2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2021,2022,2023],[0.2146707586623627,0.2228430248518417,0.2285549244247617,0.226751273795755,0.2256407138296902,0.2292070497718665,0.228328702558806,0.2246547143830758,0.2195626791211124,0.2192716430082316,0.2138528138528139,0.2274638960300442,0.2208339704244119,0.2223062381852552],[1.106345130601893,1.148462403401646,1.177899725551918,1.168604281201963,1.162880806713154,1.181260573143863,1.176733849671125,1.15779927770876,1.131556539983186,1.130056631992358,1.102129701994923,1.172276910598612,1.138108372900468,1.14569597485567]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>NAME<\/th>\n      <th>Year<\/th>\n      <th>Rent to Income Ratio<\/th>\n      <th>Standardized Metric<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"searching":false,"info":false,"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"NAME","targets":1},{"name":"Year","targets":2},{"name":"Rent to Income Ratio","targets":3},{"name":"Standardized Metric","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="highlight-the-metro-areas-highest-and-lowest-with-the-highest-and-lowest-rent-burden" class="level3">
<h3 class="anchored" data-anchor-id="highlight-the-metro-areas-highest-and-lowest-with-the-highest-and-lowest-rent-burden">Highlight the Metro Areas highest and lowest with the highest and lowest rent burden</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>standard_ratio <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(standardized_metric <span class="sc">==</span> <span class="fu">max</span>(standardized_metric) <span class="sc">|</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>         standardized_metric <span class="sc">==</span> <span class="fu">min</span>(standardized_metric)) <span class="sc">|&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NAME, year, rent_to_income, standardized_metric) <span class="sc">|&gt;</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Year =</span> year,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Rent to Income Ratio</span><span class="st">`</span> <span class="ot">=</span> rent_to_income,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Standardized Metric</span><span class="st">`</span> <span class="ot">=</span> standardized_metric) <span class="sc">|&gt;</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(<span class="at">options =</span> <span class="fu">list</span>(<span class="at">searching =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-c43ccf1ab52896014508" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c43ccf1ab52896014508">{"x":{"filter":"none","vertical":false,"data":[["1","2"],["Bismarck, ND Metro Area","Mayagüez, PR Metro Area"],[2009,2018],[0.1231254932912391,0.3819406799349493],[0.6345498138848349,1.968401351249768]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>NAME<\/th>\n      <th>Year<\/th>\n      <th>Rent to Income Ratio<\/th>\n      <th>Standardized Metric<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"searching":false,"info":false,"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"NAME","targets":1},{"name":"Year","targets":2},{"name":"Rent to Income Ratio","targets":3},{"name":"Standardized Metric","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Thus, the Metro Areas with the highest and lowest rent burden are Bismarck, ND Metro Area and Mayagüez, PR Metro Area, respectively.</p>
</section>
</section>
<section id="task-5-housing-growth" class="level2">
<h2 class="anchored" data-anchor-id="task-5-housing-growth">Task 5: Housing Growth</h2>
<section id="instantaneous-measure" class="level3">
<h3 class="anchored" data-anchor-id="instantaneous-measure">Instantaneous Measure</h3>
<p>This is the table for instantaneous measure.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>table1 <span class="ot">&lt;-</span> PERMITS <span class="sc">|&gt;</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(POPULATION, <span class="fu">join_by</span>(CBSA <span class="sc">==</span> GEOID, year <span class="sc">==</span> year)) <span class="sc">|&gt;</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">instantaneous =</span> new_housing_units_permitted <span class="sc">/</span> population)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>baseline <span class="ot">&lt;-</span> table1 <span class="sc">|&gt;</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">|&gt;</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">baseline =</span> <span class="fu">mean</span>(instantaneous)) </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>table1 <span class="ot">&lt;-</span> table1 <span class="sc">|&gt;</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">standardized_instantaneous =</span> instantaneous <span class="sc">/</span> baseline[[<span class="dv">1</span>]])</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>table1 <span class="sc">|&gt;</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(standardized_instantaneous <span class="sc">==</span> <span class="fu">max</span>(standardized_instantaneous) <span class="sc">|</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>         standardized_instantaneous <span class="sc">==</span> <span class="fu">min</span>(standardized_instantaneous)) <span class="sc">|&gt;</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CBSA, year, NAME, instantaneous, standardized_instantaneous) <span class="sc">|&gt;</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Year =</span> year,</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Instantaneous Measure</span><span class="st">`</span> <span class="ot">=</span> instantaneous,</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Standardized Instantaneous Measure</span><span class="st">`</span> <span class="ot">=</span> standardized_instantaneous) <span class="sc">|&gt;</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(<span class="at">options =</span> <span class="fu">list</span>(<span class="at">searching =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-862bff9497327ea425d0" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-862bff9497327ea425d0">{"x":{"filter":"none","vertical":false,"data":[["1","2"],[19180,41540],[2022,2023],["Danville, IL Metro Area","Salisbury, MD Metro Area"],[2.764836805507555e-05,0.03773032148639272],[0.01170173446314709,15.96876178599231]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>CBSA<\/th>\n      <th>Year<\/th>\n      <th>NAME<\/th>\n      <th>Instantaneous Measure<\/th>\n      <th>Standardized Instantaneous Measure<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"searching":false,"info":false,"columnDefs":[{"className":"dt-right","targets":[1,2,4,5]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"CBSA","targets":1},{"name":"Year","targets":2},{"name":"NAME","targets":3},{"name":"Instantaneous Measure","targets":4},{"name":"Standardized Instantaneous Measure","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Thus, Salisbury, MD Metro Area and Danville, IL Metro Area have the highest and the lowest standardized instantaneous measure, respectively.</p>
</section>
<section id="rate-based-measure" class="level3">
<h3 class="anchored" data-anchor-id="rate-based-measure">Rate-based Measure</h3>
<p>This is the table for rate-based measure.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>table2 <span class="ot">&lt;-</span> PERMITS <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(POPULATION, <span class="fu">join_by</span>(CBSA <span class="sc">==</span> GEOID, year <span class="sc">==</span> year)) <span class="sc">|&gt;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rate_based =</span> new_housing_units_permitted <span class="sc">/</span> (population <span class="sc">-</span> <span class="fu">lag</span>(population, <span class="at">n =</span> <span class="dv">5</span>)))</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>baseline <span class="ot">&lt;-</span> table2 <span class="sc">|&gt;</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">baseline =</span> <span class="fu">mean</span>(rate_based, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) </span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>table2 <span class="ot">&lt;-</span> table2 <span class="sc">|&gt;</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">standardized_rate_based =</span> rate_based <span class="sc">/</span> baseline[[<span class="dv">1</span>]])</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>table2 <span class="sc">|&gt;</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">:-</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(standardized_rate_based <span class="sc">==</span> <span class="fu">max</span>(standardized_rate_based) <span class="sc">|</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>         standardized_rate_based <span class="sc">==</span> <span class="fu">min</span>(standardized_rate_based)) <span class="sc">|&gt;</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CBSA, year, NAME, rate_based, standardized_rate_based) <span class="sc">|&gt;</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Year =</span> year,</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Rate-based Measure</span><span class="st">`</span> <span class="ot">=</span> rate_based,</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Standardized Rate-based Measure</span><span class="st">`</span> <span class="ot">=</span> standardized_rate_based) <span class="sc">|&gt;</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(<span class="at">options =</span> <span class="fu">list</span>(<span class="at">searching =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-0fa60d0ffa7277c1a17a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-0fa60d0ffa7277c1a17a">{"x":{"filter":"none","vertical":false,"data":[["1","2"],[40060,43900],[2015,2023],["Richmond, VA Metro Area","Spartanburg, SC Metro Area"],[-2.009480626545754,89.59375],[-431.1795903826968,19224.36868289466]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>CBSA<\/th>\n      <th>Year<\/th>\n      <th>NAME<\/th>\n      <th>Rate-based Measure<\/th>\n      <th>Standardized Rate-based Measure<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"searching":false,"info":false,"columnDefs":[{"className":"dt-right","targets":[1,2,4,5]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"CBSA","targets":1},{"name":"Year","targets":2},{"name":"NAME","targets":3},{"name":"Rate-based Measure","targets":4},{"name":"Standardized Rate-based Measure","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Thus, Spartanburg, SC Metro Area and Richmond, VA Metro Area have the highest and the lowest standardized rate-based measure, respectively.</p>
</section>
<section id="composite-score" class="level3">
<h3 class="anchored" data-anchor-id="composite-score">Composite Score</h3>
<p>This is the table for the composite score.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>table3 <span class="ot">&lt;-</span> table1 <span class="sc">|&gt;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(table2, <span class="fu">join_by</span>(CBSA <span class="sc">==</span> CBSA, </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                             year <span class="sc">==</span> year,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                             NAME <span class="sc">==</span> NAME)) <span class="sc">|&gt;</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CBSA, year, NAME, standardized_instantaneous, standardized_rate_based) <span class="sc">|&gt;</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">composite =</span> <span class="fu">rowMeans</span>(<span class="fu">cbind</span>(standardized_instantaneous, standardized_rate_based),</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>baseline <span class="ot">&lt;-</span> table3 <span class="sc">|&gt;</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">baseline =</span> <span class="fu">mean</span>(composite)) </span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>table3 <span class="ot">&lt;-</span> table3 <span class="sc">|&gt;</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">standardized_composite =</span> composite <span class="sc">/</span> baseline[[<span class="dv">1</span>]])</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>table3 <span class="sc">|&gt;</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(standardized_composite <span class="sc">==</span> <span class="fu">max</span>(standardized_composite) <span class="sc">|</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>         standardized_composite <span class="sc">==</span> <span class="fu">min</span>(standardized_composite)) <span class="sc">|&gt;</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CBSA, year, NAME, composite, standardized_composite) <span class="sc">|&gt;</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Year =</span> year,</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Composite Score</span><span class="st">`</span> <span class="ot">=</span> composite,</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Standardized Composite Score</span><span class="st">`</span> <span class="ot">=</span> standardized_composite) <span class="sc">|&gt;</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(<span class="at">options =</span> <span class="fu">list</span>(<span class="at">searching =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-a63881af696dfcdfc5bf" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a63881af696dfcdfc5bf">{"x":{"filter":"none","vertical":false,"data":[["1","2"],[40060,43900],[2015,2023],["Richmond, VA Metro Area","Spartanburg, SC Metro Area"],[-214.7782152727455,9613.767079426212],[-215.3431934490879,9639.056276402807]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>CBSA<\/th>\n      <th>Year<\/th>\n      <th>NAME<\/th>\n      <th>Composite Score<\/th>\n      <th>Standardized Composite Score<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"searching":false,"info":false,"columnDefs":[{"className":"dt-right","targets":[1,2,4,5]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"CBSA","targets":1},{"name":"Year","targets":2},{"name":"NAME","targets":3},{"name":"Composite Score","targets":4},{"name":"Standardized Composite Score","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Thus, Spartanburg, SC Metro Area and Richmond, VA Metro Area have the highest and the lowest standardized composite score, respectively.</p>
</section>
</section>
<section id="task-6-visualization" class="level2">
<h2 class="anchored" data-anchor-id="task-6-visualization">Task 6: Visualization</h2>
<section id="first-plot" class="level3">
<h3 class="anchored" data-anchor-id="first-plot">First Plot</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>Vis <span class="ot">&lt;-</span> table1 <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(table2, <span class="fu">join_by</span>(CBSA <span class="sc">==</span> CBSA, </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                             year <span class="sc">==</span> year,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>                             NAME <span class="sc">==</span> NAME)) <span class="sc">|&gt;</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(standard_ratio, <span class="fu">join_by</span>(year <span class="sc">==</span> year,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>                             NAME <span class="sc">==</span> NAME)) <span class="sc">|&gt;</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CBSA, NAME) <span class="sc">|&gt;</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">high_rent =</span> <span class="fu">mean</span>(standardized_metric[year <span class="sc">%in%</span> <span class="dv">2009</span><span class="sc">:</span><span class="dv">2014</span>]),</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">decrease_rent =</span> <span class="fu">last</span>(standardized_metric) <span class="sc">-</span> <span class="fu">first</span>(standardized_metric),</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">population_growth =</span> <span class="fu">last</span>(population.x) <span class="sc">-</span> <span class="fu">first</span>(population.x),</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">housing_growth =</span> <span class="fu">mean</span>(standardized_instantaneous)) <span class="sc">|&gt;</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(high_rent <span class="sc">&gt;</span> <span class="fu">mean</span>(high_rent, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>         decrease_rent <span class="sc">&lt;</span> <span class="dv">0</span>,</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>         population_growth <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>         housing_growth <span class="sc">&gt;</span> <span class="fu">mean</span>(housing_growth))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'CBSA'. You can override using the
`.groups` argument.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(standard_ratio <span class="sc">|&gt;</span> <span class="fu">filter</span>(NAME <span class="sc">%in%</span> Vis<span class="sc">$</span>NAME),</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> standardized_metric, <span class="at">color =</span> NAME)) <span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>)) <span class="sc">+</span> </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span> </span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Standardized Rent To Income Ratio"</span>) <span class="sc">+</span> </span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"The Most “YIMBY” CBSAs"</span>,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="cn">NULL</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="second-plot" class="level3">
<h3 class="anchored" data-anchor-id="second-plot">Second Plot</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(table3 <span class="sc">|&gt;</span> <span class="fu">filter</span>(NAME <span class="sc">%in%</span> Vis<span class="sc">$</span>NAME),</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> standardized_instantaneous, <span class="at">color =</span> NAME)) <span class="sc">+</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>)) <span class="sc">+</span> </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span> </span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Standardized Instantaneous Measure"</span>) <span class="sc">+</span> </span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"The Most “YIMBY” CBSAs"</span>,</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="cn">NULL</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The most “YIMBY” CBSAs are Baltimore-Columbia-Towson, MD Metro Area; Bend-Redmond, OR Metro Area;Cape Girardeau, MO-IL Metro Area; Elizabethtown, KY Metro Area; Gulfport-Biloxi, MS Metro Area; Hinesville, GA Metro Area; Indianapolis-Carmel-Anderson, IN Metro Area; Madera, CA Metro Area; Naples-Immokalee-Marco Island, FL Metro Area; Providence-Warwick, RI-MA Metro Area; Salisbury, MD Metro Area; Stockton-Lodi, CA Metro Area; and Wenatchee, WA Metro Area. Because they had relatively high rent burden in the early part of the study period (presumably “above its average”); had a decrease in rent burden over the study period; had population growth over the study period; and had above-average housing growth during the study period.</p>
<p>Among all of the “YIMBY” CBSAs, Salisbury, MD Metro Area is the best, since it shows clear upward trend in the second plot.</p>
</section>
<section id="task-7-policy-brief" class="level3">
<h3 class="anchored" data-anchor-id="task-7-policy-brief">Task 7: Policy Brief</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(<span class="st">"C"</span>, GEOID))</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>t2 <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(FIPS, <span class="st">"0"</span>))</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>Commercial_and_institutional_construction <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(t1, t2, <span class="fu">join_by</span>(std_cbsa <span class="sc">==</span> std_cbsa)) <span class="sc">|&gt;</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(std_cbsa <span class="sc">==</span> <span class="st">"C35620"</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>         INDUSTRY <span class="sc">==</span> <span class="dv">23622</span>,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>         year <span class="sc">==</span> <span class="dv">2023</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="st">`</span><span class="at">Total employment for commercial and institutional building construction</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(EMPLOYMENT)) <span class="sc">|&gt;</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(<span class="at">options =</span> <span class="fu">list</span>(<span class="at">searching =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in inner_join(t1, t2, join_by(std_cbsa == std_cbsa)): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 2 of `x` matches multiple rows in `y`.
ℹ Row 1 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>Commercial_and_institutional_construction</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>Heavy_and_civil_engineering_construction <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(t1, t2, <span class="fu">join_by</span>(std_cbsa <span class="sc">==</span> std_cbsa)) <span class="sc">|&gt;</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(std_cbsa <span class="sc">==</span> <span class="st">"C12580"</span>,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>         INDUSTRY <span class="sc">==</span> <span class="dv">237</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>         year <span class="sc">==</span> <span class="dv">2023</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="st">`</span><span class="at">Total employment for heavy and civil engineering construction</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(EMPLOYMENT)) <span class="sc">|&gt;</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(<span class="at">options =</span> <span class="fu">list</span>(<span class="at">searching =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in inner_join(t1, t2, join_by(std_cbsa == std_cbsa)): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 2 of `x` matches multiple rows in `y`.
ℹ Row 1 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>Heavy_and_civil_engineering_construction</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>A primary sponsor from Baltimore-Columbia-Towson, MD Metro Area and a co-sponsor from New York, together they will sponsor my bill. They need this bills, especially the co-sponsor from New York, because they can establish a more-YIMBY set of housing policies. In 2023, Baltimore-Columbia-Towson, MD Metro Area has 120,114 heavy and civil engineering construction workers; in 2023, NYC has 444,814 commercial and institutional building construction workers. These numbers are definitely non-trivial. My policy will be favorable for the interest groups because those workers in Baltimore-Columbia-Towson, MD Metro Area may spend less on rent based on the previous reasoning of YIMBY success; for NYC, if the rent goes down, the income for commercial and institutional building construction workers would arise because the budget for the commercial and institutional building becomes more.</p>
<p>Metrics the government can use to identify ‘good’ (high-YIMBY) cities and to target funding appropriately could be “standardized_metric”, “standardized_instantaneous”, “standardized_rate_based”, and “composite”. “standardized_metric” is calculated by using the average rent-to-income ratio in the first year of my study, which is 2009, and divided by baseline value. “standardized_instantaneous” is concluded by “new_housing_units_permitted / population / baseline value”. “standardized_rate_based” utilized lag function for the first five years of my study, specifically, “new_housing_units_permitted / (population - lag(population, n = 5) / baseline value”. “composite” is simply by taking the average of the previous two value.</p>
<p>(Extra Credit Opportunity #03) The sponsors’ hometown needs this bill because young people care about affordability of the household. If young people could not affor the house or living places, they definitely would not want to come to this city. Therefore, I designed a variable called “affordability”. It is calculated by household_income divided by (12 * monthly_rent). Therefore, larger value means the house in that area is more affordable, which suggests it is more appeal to young people.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>affordability <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2023</span>) <span class="sc">|&gt;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(RENT <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2023</span>), <span class="fu">join_by</span>(GEOID <span class="sc">==</span> GEOID)) <span class="sc">|&gt;</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NAME.x, household_income, monthly_rent) <span class="sc">|&gt;</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(household_income <span class="sc">/</span> (<span class="dv">12</span> <span class="sc">*</span> monthly_rent))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>By now, we have completed all boded Tasks and all three Extra Credit Opportunity.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/<Benjamin-Kuang>\.github\.io\/STA9750-2025-FALL\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>